import{r as m,j as e}from"./ui-vendor-JVI_EMCz.js";import{l as y,m as A,al as N,aa as T,am as F,an as W}from"./index-BhiXzLWp.js";import{a as B}from"./gemini-BWHSVO4r.js";import{R as C,L as P,C as D,X as I,Y as L,T as S,a as Y,B as K,b as O,P as G,c as X,d as U}from"./chart-vendor-FnQjAE1u.js";import"./react-vendor-Bzgz95E1.js";import"./firebase-vendor-CyvWsNSE.js";function M(i,n,t){return i.filter(r=>{const s=new Date(r.date);return s.getFullYear()===n&&s.getMonth()+1===t})}function w(i,n,t,r){const s=M(t,i,n),a=M(r,i,n),o=s.reduce((c,d)=>c+d.calories,0),l=s.reduce((c,d)=>c+(d.price||0),0),h=a.reduce((c,d)=>c+d.amount,0),x={};return a.forEach(c=>{x[c.category]=(x[c.category]||0)+c.amount}),{year:i,month:n,intakes:{count:s.length,totalCalories:o,avgCalories:s.length>0?o/s.length:0,totalPrice:l},expenses:{count:a.length,total:h,byCategory:x}}}function _(i,n,t,r){const s=w(i,n,t,r);let a=i,o=n-1;o===0&&(o=12,a-=1);const l=w(a,o,t,r),h=(x,c)=>c===0?x>0?100:0:(x-c)/c*100;return{current:s,previous:l,changes:{intakesCount:h(s.intakes.count,l.intakes.count),totalCalories:h(s.intakes.totalCalories,l.intakes.totalCalories),avgCalories:h(s.intakes.avgCalories,l.intakes.avgCalories),totalExpenses:h(s.expenses.total,l.expenses.total)}}}function q(i){const{current:n,previous:t,changes:r}=i;return`ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœˆæ¬¡å¥åº·ãƒ»å®¶è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€3ã€œ5ã¤ã®å…·ä½“çš„ãªæ”¹å–„ææ¡ˆã‚’ã—ã¦ãã ã•ã„ã€‚

ã€ä»Šæœˆã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ${n.year}å¹´${n.month}æœˆï¼‰ã€‘
- é£Ÿäº‹è¨˜éŒ²: ${n.intakes.count}å›
- ç·ã‚«ãƒ­ãƒªãƒ¼: ${n.intakes.totalCalories.toLocaleString()}kcal
- å¹³å‡ã‚«ãƒ­ãƒªãƒ¼: ${Math.round(n.intakes.avgCalories)}kcal/é£Ÿ
- é£Ÿè²»: Â¥${n.intakes.totalPrice.toLocaleString()}
- ç·æ”¯å‡º: Â¥${n.expenses.total.toLocaleString()}

ã€å…ˆæœˆã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ${t.year}å¹´${t.month}æœˆï¼‰ã€‘
- é£Ÿäº‹è¨˜éŒ²: ${t.intakes.count}å›
- ç·ã‚«ãƒ­ãƒªãƒ¼: ${t.intakes.totalCalories.toLocaleString()}kcal
- å¹³å‡ã‚«ãƒ­ãƒªãƒ¼: ${Math.round(t.intakes.avgCalories)}kcal/é£Ÿ
- ç·æ”¯å‡º: Â¥${t.expenses.total.toLocaleString()}

ã€å…ˆæœˆæ¯”ã®å¤‰åŒ–ã€‘
- é£Ÿäº‹è¨˜éŒ²å›æ•°: ${r.intakesCount>0?"+":""}${r.intakesCount.toFixed(1)}%
- ç·ã‚«ãƒ­ãƒªãƒ¼: ${r.totalCalories>0?"+":""}${r.totalCalories.toFixed(1)}%
- å¹³å‡ã‚«ãƒ­ãƒªãƒ¼: ${r.avgCalories>0?"+":""}${r.avgCalories.toFixed(1)}%
- ç·æ”¯å‡º: ${r.totalExpenses>0?"+":""}${r.totalExpenses.toFixed(1)}%

ã€ãŠé¡˜ã„ã€‘
1. ãƒ‡ãƒ¼ã‚¿ã®å‚¾å‘ã‚’ç°¡æ½”ã«åˆ†æã—ã¦ãã ã•ã„
2. å¥åº·é¢ã§ã®æ”¹å–„ææ¡ˆã‚’2ã€œ3ç‚¹
3. å®¶è¨ˆé¢ã§ã®æ”¹å–„ææ¡ˆã‚’1ã€œ2ç‚¹
4. å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ãŠé¡˜ã„ã—ã¾ã™
5. æ—¥æœ¬èªã§ã€è¦ªã—ã¿ã‚„ã™ãã‚ã‹ã‚Šã‚„ã™ã„è¡¨ç¾ã§å›ç­”ã—ã¦ãã ã•ã„`}function H(){const{intakes:i}=y(),{expenses:n}=A(),t=new Date,[r,s]=m.useState(t.getFullYear()),[a,o]=m.useState(t.getMonth()+1),[l,h]=m.useState(null),[x,c]=m.useState(""),[d,u]=m.useState(!1);m.useEffect(()=>{const p=_(r,a,i,n);h(p)},[r,a,i,n]);const $=async()=>{if(l){u(!0);try{const p=q(l),b=await B(p);c(b)}catch(p){console.error("AIææ¡ˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:",p),alert("AIææ¡ˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{u(!1)}}},E=()=>{a===1?(s(r-1),o(12)):o(a-1),c("")},R=()=>{a===12?(s(r+1),o(1)):o(a+1),c("")},f=p=>{if(p===0)return e.jsx("span",{className:"change-neutral",children:"Â±0%"});const b=p>0?e.jsx(F,{}):e.jsx(W,{}),z=p>0?"change-up":"change-down";return e.jsxs("span",{className:`change ${z}`,children:[b," ",p>0?"+":"",p.toFixed(1),"%"]})};if(!l)return e.jsx("div",{className:"card",children:"ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."});const{current:g,previous:j,changes:v}=l;return e.jsx("div",{className:"monthly-report",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"report-header",children:[e.jsx("h3",{children:"ğŸ“Š æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ"}),e.jsxs("div",{className:"month-selector",children:[e.jsx("button",{className:"month-nav-btn",onClick:E,children:"â—€"}),e.jsxs("span",{className:"current-month",children:[r,"å¹´",a,"æœˆ"]}),e.jsx("button",{className:"month-nav-btn",onClick:R,children:"â–¶"})]})]}),e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"ä»Šæœˆã®è¨˜éŒ²"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"é£Ÿäº‹è¨˜éŒ²"}),e.jsxs("div",{className:"stat-value",children:[g.intakes.count,"å›"]}),f(v.intakesCount)]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"å¹³å‡ã‚«ãƒ­ãƒªãƒ¼"}),e.jsxs("div",{className:"stat-value",children:[Math.round(g.intakes.avgCalories),"kcal"]}),f(v.avgCalories)]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"ç·ã‚«ãƒ­ãƒªãƒ¼"}),e.jsxs("div",{className:"stat-value",children:[g.intakes.totalCalories.toLocaleString(),"kcal"]}),f(v.totalCalories)]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"ç·æ”¯å‡º"}),e.jsxs("div",{className:"stat-value",children:["Â¥",g.expenses.total.toLocaleString()]}),f(v.totalExpenses)]})]})]}),e.jsxs("div",{className:"report-section",children:[e.jsxs("h4",{children:["å…ˆæœˆï¼ˆ",j.year,"å¹´",j.month,"æœˆï¼‰ã¨ã®æ¯”è¼ƒ"]}),e.jsxs("div",{className:"comparison-grid",children:[e.jsxs("div",{className:"comparison-item",children:[e.jsx("div",{className:"comparison-label",children:"é£Ÿäº‹è¨˜éŒ²"}),e.jsxs("div",{className:"comparison-values",children:[e.jsxs("span",{className:"prev-value",children:[j.intakes.count,"å›"]}),e.jsx(N,{}),e.jsxs("span",{className:"curr-value",children:[g.intakes.count,"å›"]})]})]}),e.jsxs("div",{className:"comparison-item",children:[e.jsx("div",{className:"comparison-label",children:"å¹³å‡ã‚«ãƒ­ãƒªãƒ¼"}),e.jsxs("div",{className:"comparison-values",children:[e.jsxs("span",{className:"prev-value",children:[Math.round(j.intakes.avgCalories),"kcal"]}),e.jsx(N,{}),e.jsxs("span",{className:"curr-value",children:[Math.round(g.intakes.avgCalories),"kcal"]})]})]}),e.jsxs("div",{className:"comparison-item",children:[e.jsx("div",{className:"comparison-label",children:"ç·æ”¯å‡º"}),e.jsxs("div",{className:"comparison-values",children:[e.jsxs("span",{className:"prev-value",children:["Â¥",j.expenses.total.toLocaleString()]}),e.jsx(N,{}),e.jsxs("span",{className:"curr-value",children:["Â¥",g.expenses.total.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"report-section",children:[e.jsxs("h4",{children:[e.jsx(T,{size:20,style:{marginRight:"8px"}}),"AIæ”¹å–„ææ¡ˆ"]}),x?e.jsxs("div",{className:"ai-suggestions",children:[e.jsx("div",{className:"suggestions-content",children:x}),e.jsx("button",{className:"submit",onClick:$,disabled:d,style:{marginTop:"12px"},children:"å†ç”Ÿæˆ"})]}):e.jsx("button",{className:"submit",onClick:$,disabled:d||g.intakes.count===0,style:{width:"100%"},children:d?"ææ¡ˆã‚’ç”Ÿæˆä¸­...":"AIæ”¹å–„ææ¡ˆã‚’ç”Ÿæˆ"}),g.intakes.count===0&&e.jsx("p",{className:"no-data-message",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚é£Ÿäº‹è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚"})]})]})})}const J=()=>{const{intakes:i}=y(),n=m.useMemo(()=>{const r=new Date,s=[];for(let a=6;a>=0;a--){const o=new Date(r);o.setDate(o.getDate()-a);const l=o.toISOString().split("T")[0],x=i.filter(c=>c.date.startsWith(l)).reduce((c,d)=>c+d.calories,0);s.push({date:`${o.getMonth()+1}/${o.getDate()}`,calories:x})}return s},[i]),t=n.some(r=>r.calories>0);return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"ğŸ“ˆ é€±é–“ã‚«ãƒ­ãƒªãƒ¼æ¨ç§»"}),t?e.jsx(C,{width:"100%",height:250,children:e.jsxs(P,{data:n,margin:{top:10,right:10,left:-20,bottom:5},children:[e.jsx(D,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(I,{dataKey:"date",tick:{fontSize:12},stroke:"#9ca3af"}),e.jsx(L,{tick:{fontSize:12},stroke:"#9ca3af"}),e.jsx(S,{contentStyle:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"},labelStyle:{fontWeight:600,marginBottom:"4px"}}),e.jsx(Y,{type:"monotone",dataKey:"calories",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"ã‚«ãƒ­ãƒªãƒ¼ (kcal)"})]})}):e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[e.jsx("p",{children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{style:{fontSize:"0.85rem",marginTop:"8px"},children:"é£Ÿäº‹è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã‚«ãƒ­ãƒªãƒ¼ã®æ¨ç§»ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]})]})},Q=()=>{const{expenses:i}=A(),n=m.useMemo(()=>{const r=new Date,s=[];for(let a=5;a>=0;a--){const o=new Date(r.getFullYear(),r.getMonth()-a,1),l=o.getFullYear(),h=o.getMonth()+1,c=i.filter(d=>{const u=new Date(d.date);return u.getFullYear()===l&&u.getMonth()+1===h}).reduce((d,u)=>d+u.amount,0);s.push({month:`${h}æœˆ`,amount:c})}return s},[i]),t=n.some(r=>r.amount>0);return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"ğŸ’° æœˆé–“æ”¯å‡ºæ¨ç§»"}),t?e.jsx(C,{width:"100%",height:250,children:e.jsxs(K,{data:n,margin:{top:10,right:10,left:-20,bottom:5},children:[e.jsx(D,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(I,{dataKey:"month",tick:{fontSize:12},stroke:"#9ca3af"}),e.jsx(L,{tick:{fontSize:12},stroke:"#9ca3af"}),e.jsx(S,{contentStyle:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"},labelStyle:{fontWeight:600,marginBottom:"4px"},formatter:r=>`Â¥${r.toLocaleString()}`}),e.jsx(O,{dataKey:"amount",fill:"#22c55e",radius:[4,4,0,0],name:"æ”¯å‡ºé¡"})]})}):e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[e.jsx("p",{children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{style:{fontSize:"0.85rem",marginTop:"8px"},children:"é£Ÿäº‹è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨ã€æ”¯å‡ºã®æ¨ç§»ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]})]})},V=()=>{const{intakes:i}=y(),n=m.useMemo(()=>{const t=new Map;return i.forEach(s=>{const a=t.get(s.name)||0;t.set(s.name,a+1)}),Array.from(t.entries()).sort((s,a)=>a[1]-s[1]).slice(0,5).map(([s,a],o)=>({rank:o+1,name:s,count:a}))},[i]);return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"ğŸ† ã‚ˆãè²·ã†å•†å“ TOP5"}),n.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[e.jsx("p",{children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{style:{fontSize:"0.85rem",marginTop:"8px"},children:"é£Ÿäº‹è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ã‚ˆãè²·ã†å•†å“ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]}):e.jsx("div",{style:{marginTop:"16px"},children:n.map(t=>e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 0",borderBottom:t.rank<n.length?"1px solid var(--border)":"none"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:t.rank===1?"linear-gradient(135deg, #ffd700 0%, #ffed4e 100%)":t.rank===2?"linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%)":t.rank===3?"linear-gradient(135deg, #cd7f32 0%, #daa06d 100%)":"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:"1.1rem",color:t.rank<=3?"#fff":"#666",marginRight:"16px",flexShrink:0},children:t.rank}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.95rem",marginBottom:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:["è³¼å…¥å›æ•°: ",t.count,"å›"]})]})]},t.rank))})]})},k=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#ec4899"],Z=()=>{const{intakes:i}=y(),n=m.useMemo(()=>{const s=new Map;return i.forEach(o=>{const l=o.manufacturer||"ãã®ä»–",h=s.get(l)||0;s.set(l,h+o.price)}),Array.from(s.entries()).sort((o,l)=>l[1]-o[1]).slice(0,6).map(([o,l])=>({name:o,value:l}))},[i]),t=n.reduce((s,a)=>s+a.value,0),r=t>0;return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"ğŸ­ ãƒ¡ãƒ¼ã‚«ãƒ¼åˆ¥æ”¯å‡ºåˆ†æ"}),r?e.jsxs(e.Fragment,{children:[e.jsx(C,{width:"100%",height:250,children:e.jsxs(G,{children:[e.jsx(X,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:s=>`${s.name} ${((s.percent||0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:n.map((s,a)=>e.jsx(U,{fill:k[a%k.length]},`cell-${a}`))}),e.jsx(S,{formatter:s=>`Â¥${s.toLocaleString()}`,contentStyle:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px 12px"}})]})}),e.jsx("div",{style:{marginTop:"16px"},children:n.map((s,a)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:a<n.length-1?"1px solid var(--border)":"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",background:k[a%k.length],flexShrink:0}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:500},children:s.name})]}),e.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:600,color:"var(--primary)"},children:["Â¥",s.value.toLocaleString()]})]},s.name))}),e.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"var(--background)",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:600},children:"åˆè¨ˆ"}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:700,color:"var(--primary)"},children:["Â¥",t.toLocaleString()]})]})]}):e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[e.jsx("p",{children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{style:{fontSize:"0.85rem",marginTop:"8px"},children:"ãƒ¡ãƒ¼ã‚«ãƒ¼æƒ…å ±ä»˜ãã®é£Ÿäº‹è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨ã€åˆ†æãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]})]})},oe=()=>e.jsxs("section",{className:"screen active",children:[e.jsx("h2",{children:"ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆ"}),e.jsx(H,{}),e.jsx(J,{}),e.jsx(Q,{}),e.jsx(V,{}),e.jsx(Z,{})]});export{oe as ReportScreen};
