import{d as l,g as d,s as y,u as f}from"./firebase-vendor-CBmCTztv.js";import{l as p,e as S,m as R}from"./index-BvEluyUh.js";const g=[{id:"daily_post_1",type:"post",name:"1Âõû„ÅÆÂíÜÂìÆ",description:"ÊäïÁ®ø„Çí1Âõû„Åô„Çã",icon:"üìù",target:1,points:10,order:1},{id:"daily_post_3",type:"post",name:"Ë®ÄËëâ„ÅÆÈÄ£Èéñ",description:"ÊäïÁ®ø„Çí3Âõû„Åô„Çã",icon:"üìö",target:3,points:30,order:2},{id:"daily_like_5",type:"like",name:"ÂÖ±È≥¥„ÅÆÂßãÂãï",description:"„ÅÑ„ÅÑ„Å≠„Çí5Âõû„Åô„Çã",icon:"‚ù§Ô∏è",target:5,points:15,order:3},{id:"daily_like_10",type:"like",name:"Áµ∂ÂØæÂÖ±È≥¥",description:"„ÅÑ„ÅÑ„Å≠„Çí10Âõû„Åô„Çã",icon:"üíñ",target:10,points:30,order:4},{id:"daily_comment_3",type:"comment",name:"Ë®ÄËëâ„ÅÆÂàªÂç∞",description:"„Ç≥„É°„É≥„Éà„Çí3Âõû„Åô„Çã",icon:"üí¨",target:3,points:20,order:5},{id:"daily_recipe_1",type:"recipe",name:"ÂâµÈÄ†„ÅÆÂßã„Åæ„Çä",description:"„É¨„Ç∑„Éî„Çí1ÂõûÊäïÁ®ø„Åô„Çã",icon:"üç≥",target:1,points:25,order:6},{id:"daily_follow_1",type:"follow",name:"Êñ∞„Åü„Å™ÁµÜ",description:"1‰∫∫„Çí„Éï„Ç©„É≠„Éº„Åô„Çã",icon:"üë•",target:1,points:15,order:7},{id:"daily_repost_2",type:"repost",name:"Êã°Êï£„ÅÆÂäõ",description:"„É™„Éù„Çπ„Éà„Çí2Âõû„Åô„Çã",icon:"üîÑ",target:2,points:20,order:8},{id:"daily_login",type:"login",name:"Êó•Â∏∏„ÅÆË®™Âïè",description:"„Ç¢„Éó„É™„Å´„É≠„Ç∞„Ç§„É≥„Åô„Çã",icon:"üö™",target:1,points:5,order:9},{id:"daily_intake_1",type:"intake",name:"È£ü‰∫ã„ÅÆË®òÈå≤",description:"È£ü‰∫ã„Çí1ÂõûË®òÈå≤„Åô„Çã",icon:"üçΩÔ∏è",target:1,points:10,order:10},{id:"daily_expense_1",type:"expense",name:"ÊîØÂá∫„ÅÆË®òÈå≤",description:"ÊîØÂá∫„Çí1ÂõûË®òÈå≤„Åô„Çã",icon:"üí∞",target:1,points:10,order:11}],m=()=>{const o=new Date;return`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`},D=async o=>{try{const t=m(),e=l(p,`users/${o}/missionData`,t),s=await d(e);if(s.exists()){const a=s.data();return{userId:o,date:t,missions:a.missions||[],totalPoints:a.totalPoints||0,lastResetDate:a.lastResetDate||t}}return{userId:o,date:t,missions:[],totalPoints:0,lastResetDate:t}}catch(t){return console.error("„Éü„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:",t),null}},k=async o=>{try{const t=l(p,`users/${o}/cosmetics`,"data"),e=await d(t);return e.exists()&&e.data().totalPoints||0}catch(t){return console.error("„Éù„Ç§„É≥„ÉàÂèñÂæó„Ç®„É©„Éº:",t),0}},w=async(o,t,e)=>{try{const s=m(),a=l(p,`users/${o}/missionData`,s),r=await d(a);let c;r.exists()?c=r.data():c={userId:o,date:s,missions:[],totalPoints:0,lastResetDate:s};const i=g.find(u=>u.id===t);if(!i)return;let n=c.missions.find(u=>u.missionId===t);if(n||(n={missionId:t,current:0,target:i.target,completed:!1,date:s},c.missions.push(n)),n.completed)return;n.current=Math.min(e,i.target),n.target=i.target,n.completed=n.current>=i.target,n.completed&&!n.completedAt&&(n.completedAt=new Date().toISOString(),await _(o,i.points),console.log(`‚úÖ „Éü„ÉÉ„Ç∑„Éß„É≥„Äå${i.name}„Äç„Çí„ÇØ„É™„Ç¢ÔºÅ${i.points}„Éù„Ç§„É≥„ÉàÁç≤Âæó`)),await y(a,c)}catch(s){console.error("„Éü„ÉÉ„Ç∑„Éß„É≥ÈÄ≤ÊçóÊõ¥Êñ∞„Ç®„É©„Éº:",s)}},_=async(o,t)=>{try{const e=l(p,`users/${o}/cosmetics`,"data"),s=await d(e);if(s.exists()){const a=s.data().totalPoints||0;await f(e,{totalPoints:a+t})}else await y(e,{totalPoints:t,ownedCosmetics:[]})}catch(e){throw console.error("„Éù„Ç§„É≥„ÉàËøΩÂä†„Ç®„É©„Éº:",e),e}},x=async(o,t)=>{try{const e=l(p,`users/${o}/cosmetics`,"data"),s=await d(e),a=s.exists()&&s.data().totalPoints||0;return a<t?!1:(await f(e,{totalPoints:a-t}),!0)}catch(e){return console.error("„Éù„Ç§„É≥„ÉàÊ∂àË≤ª„Ç®„É©„Éº:",e),!1}},P=async(o,t,e)=>{try{const s=await S(o);if(!s)return 0;switch(t){case"post":return s.stats.postCount;case"like":return e?.likeCount||0;case"comment":return e?.commentCount||s.stats.commentCount||0;case"recipe":return s.stats.recipeCount;case"follow":return await R(o);case"repost":return e?.repostCount||s.stats.repostCount||0;case"login":return 1;case"intake":return e?.intakeCount||0;case"expense":return e?.expenseCount||0;default:return 0}}catch(s){return console.error("„Éü„ÉÉ„Ç∑„Éß„É≥ÈÄ≤ÊçóË®àÁÆó„Ç®„É©„Éº:",s),0}},h=async o=>{try{const t=m(),e=l(p,`users/${o}/missionData`,t),s=await d(e);if(s.exists()&&s.data().lastResetDate===t)return;const a=g.map(r=>({missionId:r.id,current:0,target:r.target,completed:!1,date:t}));await y(e,{userId:o,date:t,missions:a,totalPoints:0,lastResetDate:t}),console.log("‚úÖ „Éá„Ç§„É™„Éº„Éü„ÉÉ„Ç∑„Éß„É≥„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(t){console.error("„Éü„ÉÉ„Ç∑„Éß„É≥„É™„Çª„ÉÉ„Éà„Ç®„É©„Éº:",t)}},C=async(o,t)=>{try{await h(o);const e=await D(o);if(!e)return;for(const s of e.missions){if(s.completed)continue;const a=g.find(c=>c.id===s.missionId);if(!a)continue;const r=await P(o,a.type,t);await w(o,s.missionId,r)}}catch(e){console.error("„Éü„ÉÉ„Ç∑„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",e)}},b=Object.freeze(Object.defineProperty({__proto__:null,addPoints:_,calculateMissionProgress:P,checkAndUpdateMissions:C,getTodayDate:m,getUserMissionData:D,getUserTotalPoints:k,resetDailyMissions:h,spendPoints:x,updateMissionProgress:w},Symbol.toStringTag,{value:"Module"}));export{k as a,C as c,g as d,D as g,b as m,x as s};
