const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ikSvfp_l.js","assets/ui-vendor-JVI_EMCz.js","assets/react-vendor-Bzgz95E1.js","assets/firebase-vendor-CBmCTztv.js","assets/index-BBo2hHvJ.css"])))=>i.map(i=>d[i]);
import{r as g,j as e,d as ce}from"./ui-vendor-JVI_EMCz.js";import{M as Z,as as Ge,$ as Ye,u as H,av as ue,T as me,aw as K,ax as ve,ay as Ve,az as ee,aA as be,aB as te,aC as je,aD as Ze,aE as Ke,aF as Je,aG as Qe,am as Xe,aH as ke,aI as et,aJ as tt,e as Y,aK as we,aL as rt,aM as nt,aN as Se,aO as ze,aP as ot,aQ as st,aR as it,aS as at,R as dt,ab as he,aT as lt,aU as ct,C as de,z as Ce,aV as Re,g as Pe,aW as pe,aX as pt,aY as xt,aZ as gt,l as R,a_ as Te,a$ as ut,at as Be,b0 as xe,b1 as ht,b2 as ft,b3 as Me,G as yt,b4 as mt,au as vt,b5 as bt,b6 as jt,b7 as kt,b8 as wt,a9 as Ie,E as St,b9 as zt,aq as ie,ba as Ct,bb as Ae,U as Rt,bc as Pt,bd as Tt,be as Bt,bf as Mt,bg as It,bh as At,p as fe,bi as Wt,bj as Lt,bk as $t,bl as Et}from"./index-ikSvfp_l.js";import{g as We,a as Le}from"./cosmetic-BYYdM74L.js";import{P as Dt}from"./PostCreateScreen-5Bi6wn9b.js";import{d as A,g as ge,w as le,i as re,c as D,q as O,b as E,e as _,l as J,o as ne,f as $e,s as Ee,u as De}from"./firebase-vendor-CBmCTztv.js";import"./react-vendor-Bzgz95E1.js";import"./mission-DFgrfidV.js";const Ft=({images:t,initialIndex:s=0,onClose:o})=>{const[l,d]=g.useState(s),n=()=>{d(i=>i>0?i-1:t.length-1)},r=()=>{d(i=>i<t.length-1?i+1:0)},u=i=>{i.target===i.currentTarget&&o()};return e.jsxs("div",{onClick:u,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.2s ease-out"},children:[e.jsx("button",{onClick:o,style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white",transition:"background 0.2s",zIndex:1e4},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.1)"},children:e.jsx(Z,{size:28})}),t.length>1&&e.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"8px 16px",borderRadius:"20px",fontSize:"14px",fontWeight:600,zIndex:1e4},children:[l+1," / ",t.length]}),t.length>1&&e.jsx("button",{onClick:n,style:{position:"absolute",left:"20px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white",transition:"background 0.2s",zIndex:1e4},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.1)"},children:e.jsx(Ge,{size:32})}),t.length>1&&e.jsx("button",{onClick:r,style:{position:"absolute",right:"20px",background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"50%",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white",transition:"background 0.2s",zIndex:1e4},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.1)"},children:e.jsx(Ye,{size:32})}),e.jsx("img",{src:t[l],alt:`ç”»åƒ ${l+1}`,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain",animation:"slideUp 0.3s ease-out"},onClick:i=>i.stopPropagation()})]})},ae=({post:t,onPostClick:s,onUserClick:o,onQuoteRepost:l,showPinButton:d=!1,onPinToggle:n})=>{const{user:r}=H(),[u,i]=g.useState(!1),[m,j]=g.useState(!1),[f,c]=g.useState(!1),[x,S]=g.useState(t.likes),[a,p]=g.useState(t.repostCount),[y,w]=g.useState(!1),[k,b]=g.useState(!1),[M,C]=g.useState(0),[z,W]=g.useState(null),[$,v]=g.useState(!1),[T,L]=g.useState(null);g.useEffect(()=>{(async()=>{if(r)try{const P=await ke(t.id,r.uid),N=await et(t.id,r.uid),X=await tt(t.id,r.uid);i(P),j(N),c(X);const se=await Y(r.uid);W(se)}catch(P){console.error("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªã‚¨ãƒ©ãƒ¼:",P)}})()},[t.id,r]),g.useEffect(()=>{(async()=>{try{const P=await we(t.authorId);L(P)}catch(P){console.error("ç§°å·å–å¾—ã‚¨ãƒ©ãƒ¼:",P)}})()},[t.authorId]);const U=async h=>{if(h.stopPropagation(),!(!r||y||!z))try{w(!0),u?(await Se(t.id,r.uid),i(!1),S(Math.max(0,x-1))):(await ze(t.id,r.uid,z.displayName,z.avatarUrl),i(!0),S(x+1))}catch(P){console.error("ã„ã„ã­æ“ä½œã‚¨ãƒ©ãƒ¼:",P),alert("ã„ã„ã­æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{w(!1)}},Q=h=>{h.stopPropagation(),s(t.id)},oe=async h=>{if(h.stopPropagation(),!(!r||y||!z))try{w(!0),f?(await ot(t.id,r.uid),c(!1),p(Math.max(0,a-1))):(await st(t.id,r.uid,z.displayName,z.avatarUrl),c(!0),p(a+1))}catch(P){console.error("ãƒªãƒã‚¹ãƒˆæ“ä½œã‚¨ãƒ©ãƒ¼:",P),alert("ãƒªãƒã‚¹ãƒˆæ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{w(!1)}},B=async h=>{if(h.stopPropagation(),!(!r||y))try{w(!0),m?(await it(t.id,r.uid),j(!1)):(await at(t.id,r.uid),j(!0))}catch(P){console.error("ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ“ä½œã‚¨ãƒ©ãƒ¼:",P),alert("ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{w(!1)}},I=h=>{h.stopPropagation(),navigator.share?navigator.share({title:"æŠ•ç¨¿ã‚’å…±æœ‰",text:t.content}).catch(P=>console.log("Share cancelled:",P)):alert("ã“ã®æŠ•ç¨¿ã‚’ã‚·ã‚§ã‚¢ã—ã¾ã—ãŸï¼")},q=h=>{h.stopPropagation(),l&&l(t.id)},F=async h=>{if(h.stopPropagation(),!!r)try{w(!0),t.isPinned?(await rt(r.uid,t.id),alert("ãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤ã—ã¾ã—ãŸ")):(await nt(r.uid,t.id),alert("æŠ•ç¨¿ã‚’ãƒ”ãƒ³ç•™ã‚ã—ã¾ã—ãŸ")),v(!1),n&&n()}catch(P){console.error("ãƒ”ãƒ³ç•™ã‚æ“ä½œã‚¨ãƒ©ãƒ¼:",P),alert("ãƒ”ãƒ³ç•™ã‚æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{w(!1)}};return e.jsxs("div",{className:"post-card",onClick:()=>s(t.id),style:{background:"var(--card)",borderRadius:"12px",padding:"16px",marginBottom:"12px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s"},onMouseEnter:h=>{h.currentTarget.style.transform="translateY(-2px)",h.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.15)"},onMouseLeave:h=>{h.currentTarget.style.transform="translateY(0)",h.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"},children:[t.isPinned&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"var(--primary)",fontSize:"13px",fontWeight:600,marginBottom:"12px"},children:[e.jsx(ue,{size:16}),e.jsx("span",{children:"ãƒ”ãƒ³ç•™ã‚ã•ã‚ŒãŸæŠ•ç¨¿"})]}),e.jsxs("div",{onClick:h=>{o&&(h.stopPropagation(),o(t.authorId))},style:{display:"flex",alignItems:"center",marginBottom:"12px",cursor:o?"pointer":"default",padding:"4px",marginLeft:"-4px",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:h=>{o&&(h.currentTarget.style.background="rgba(0, 0, 0, 0.05)")},onMouseLeave:h=>{h.currentTarget.style.background="none"},children:[e.jsx(Nt,{authorId:t.authorId,avatarUrl:t.authorAvatar}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)",fontSize:"15px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.authorName}),T&&e.jsx(me,{title:T,size:"small",showName:!0})]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:K(t.createdAt)})]}),d&&e.jsxs("div",{style:{marginLeft:"auto",position:"relative"},children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),v(!$)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",transition:"background 0.2s"},onMouseEnter:h=>{h.currentTarget.style.background="var(--border)"},onMouseLeave:h=>{h.currentTarget.style.background="none"},children:e.jsx(ve,{size:20})}),$&&e.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"4px",background:"var(--card)",border:"1px solid var(--border)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",minWidth:"180px",zIndex:10},children:e.jsxs("button",{onClick:F,disabled:y,style:{width:"100%",padding:"12px 16px",background:"none",border:"none",cursor:y?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",color:"var(--text)",fontSize:"14px",fontWeight:500,transition:"background 0.2s",opacity:y?.6:1},onMouseEnter:h=>{y||(h.currentTarget.style.background="var(--border)")},onMouseLeave:h=>{h.currentTarget.style.background="none"},children:[e.jsx(ue,{size:18}),e.jsx("span",{children:t.isPinned?"ãƒ”ãƒ³ç•™ã‚ã‚’è§£é™¤":"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«ãƒ”ãƒ³ç•™ã‚"})]})})]})]}),t.replyToUserName&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"14px",marginBottom:"8px"},children:[e.jsx("span",{style:{marginRight:"4px"},children:"ğŸ’¬"}),e.jsxs("span",{children:[t.replyToUserName,"ã•ã‚“ã¸ã®è¿”ä¿¡"]})]}),e.jsx("div",{style:{color:"var(--text)",fontSize:"15px",lineHeight:"1.5",marginBottom:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:t.content.split(/(@[a-zA-Z0-9_]+)/g).map((h,P)=>h.match(/^@[a-zA-Z0-9_]+$/)?e.jsx("span",{onClick:async N=>{N.stopPropagation();const X=h.substring(1);console.log("Mention clicked:",X);const se=await Ve(X);se&&o?o(se):console.warn("User not found:",X)},style:{color:"var(--primary)",cursor:"pointer",fontWeight:600},children:h},P):h)}),t.recipeData&&e.jsxs("div",{style:{marginBottom:"12px",padding:"16px",background:"linear-gradient(135deg, rgba(22, 163, 74, 0.05), rgba(129, 199, 132, 0.05))",borderRadius:"12px",border:"2px solid var(--primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"ğŸ‘¨â€ğŸ³"}),e.jsx("div",{style:{fontWeight:700,fontSize:"16px",color:"var(--text)"},children:t.recipeData.title}),e.jsx("div",{style:{marginLeft:"auto",padding:"4px 12px",background:"var(--primary)",color:"white",borderRadius:"12px",fontSize:"12px",fontWeight:600},children:t.recipeData.difficulty==="easy"?"ç°¡å˜":t.recipeData.difficulty==="medium"?"æ™®é€š":"é›£ã—ã„"})]}),e.jsx("div",{style:{fontSize:"14px",color:"var(--text-secondary)",marginBottom:"12px"},children:t.recipeData.description}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"13px",color:"var(--text-secondary)",marginBottom:"12px"},children:[e.jsxs("span",{children:["ğŸ½ï¸ ",t.recipeData.servings,"äººåˆ†"]}),e.jsxs("span",{children:["â±ï¸ ",t.recipeData.preparationTime+t.recipeData.cookingTime,"åˆ†"]})]}),t.recipeData.ingredients&&t.recipeData.ingredients.length>0&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text)",marginBottom:"8px"},children:"ğŸ“ ææ–™"}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"13px",color:"var(--text)",lineHeight:"1.8"},children:t.recipeData.ingredients.map((h,P)=>e.jsx("li",{children:h},P))})]}),t.recipeData.instructions&&t.recipeData.instructions.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text)",marginBottom:"8px"},children:"ğŸ‘¨â€ğŸ³ ä½œã‚Šæ–¹"}),e.jsx("ol",{style:{margin:0,paddingLeft:"20px",fontSize:"13px",color:"var(--text)",lineHeight:"1.8"},children:t.recipeData.instructions.map((h,P)=>e.jsx("li",{style:{marginBottom:"4px"},children:h},P))})]})]}),t.quotedPost&&e.jsxs("div",{onClick:h=>{h.stopPropagation(),s(t.quotedPost.id)},style:{marginBottom:"12px",padding:"12px",background:"var(--background)",borderRadius:"12px",border:"1px solid var(--border)",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:h=>{h.currentTarget.style.background="var(--border)"},onMouseLeave:h=>{h.currentTarget.style.background="var(--background)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:t.quotedPost.authorAvatar?`url(${t.quotedPost.authorAvatar}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)"}}),e.jsx("div",{style:{fontWeight:600,fontSize:"13px",color:"var(--text)"},children:t.quotedPost.authorName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:K(t.quotedPost.createdAt)})]}),e.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.4",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",marginBottom:t.quotedPost.recipeData?"8px":"0"},children:t.quotedPost.content}),t.quotedPost.recipeData&&e.jsxs("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(22, 163, 74, 0.05)",borderRadius:"8px",border:"1px solid var(--primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"14px"},children:"ğŸ‘¨â€ğŸ³"}),e.jsx("span",{style:{fontWeight:600,fontSize:"13px",color:"var(--text)"},children:t.quotedPost.recipeData.title})]}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:t.quotedPost.recipeData.description})]}),t.quotedPost.images&&t.quotedPost.images.length>0&&e.jsx("div",{style:{marginTop:"8px",width:"100%",paddingBottom:"40%",position:"relative",borderRadius:"8px",overflow:"hidden",background:"var(--border)"},children:e.jsx("img",{src:t.quotedPost.images[0],alt:"å¼•ç”¨å…ƒç”»åƒ",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}})})]}),t.images&&t.images.length>0&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:t.images.length===1?"1fr":(t.images.length===2,"repeat(2, 1fr)"),gap:"8px",marginBottom:"16px"},children:t.images.map((h,P)=>e.jsx("div",{onClick:N=>{N.stopPropagation(),C(P),b(!0)},style:{width:"100%",paddingBottom:t.images.length===1?"56.25%":"100%",position:"relative",borderRadius:"8px",overflow:"hidden",background:"var(--border)",cursor:"pointer",transition:"opacity 0.2s"},onMouseEnter:N=>{N.currentTarget.style.opacity="0.9"},onMouseLeave:N=>{N.currentTarget.style.opacity="1"},children:e.jsx("img",{src:h,alt:`æŠ•ç¨¿ç”»åƒ ${P+1}`,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}})},P))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px",paddingTop:"12px",borderTop:"1px solid var(--border)"},children:[e.jsxs("button",{onClick:U,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"4px 8px",borderRadius:"8px",color:u?"#e91e63":"var(--text-secondary)",transition:"background 0.2s, color 0.2s"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(233, 30, 99, 0.1)"},onMouseLeave:h=>{h.currentTarget.style.background="none"},children:[u?e.jsx(ee,{size:20}):e.jsx(be,{size:20}),e.jsx("span",{style:{fontSize:"14px",fontWeight:500},children:te(x)})]}),e.jsxs("button",{onClick:Q,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"4px 8px",borderRadius:"8px",color:"var(--text-secondary)",transition:"background 0.2s"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(33, 150, 243, 0.1)",h.currentTarget.style.color="#2196f3"},onMouseLeave:h=>{h.currentTarget.style.background="none",h.currentTarget.style.color="var(--text-secondary)"},children:[e.jsx(je,{size:20}),e.jsx("span",{style:{fontSize:"14px",fontWeight:500},children:te(t.commentCount)})]}),e.jsxs("button",{onClick:oe,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"4px 8px",borderRadius:"8px",color:f?"#4caf50":"var(--text-secondary)",transition:"background 0.2s, color 0.2s",opacity:y?.6:1},onMouseEnter:h=>{h.currentTarget.style.background="rgba(76, 175, 80, 0.1)",f||(h.currentTarget.style.color="#4caf50")},onMouseLeave:h=>{h.currentTarget.style.background="none",f||(h.currentTarget.style.color="var(--text-secondary)")},children:[e.jsx(Ze,{size:20}),e.jsx("span",{style:{fontSize:"14px",fontWeight:500},children:te(a)})]}),l&&e.jsx("button",{onClick:q,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"4px 8px",borderRadius:"8px",color:"var(--text-secondary)",transition:"background 0.2s, color 0.2s"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(76, 175, 80, 0.1)",h.currentTarget.style.color="#4caf50"},onMouseLeave:h=>{h.currentTarget.style.background="none",h.currentTarget.style.color="var(--text-secondary)"},children:e.jsx(Ke,{size:20})}),e.jsx("button",{onClick:B,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"4px 8px",borderRadius:"8px",color:m?"#ff9800":"var(--text-secondary)",transition:"background 0.2s, color 0.2s",opacity:y?.6:1},onMouseEnter:h=>{h.currentTarget.style.background="rgba(255, 152, 0, 0.1)",m||(h.currentTarget.style.color="#ff9800")},onMouseLeave:h=>{h.currentTarget.style.background="none",m||(h.currentTarget.style.color="var(--text-secondary)")},children:m?e.jsx(Je,{size:20}):e.jsx(Qe,{size:20})}),e.jsx("button",{onClick:I,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",padding:"4px 8px",borderRadius:"8px",color:"var(--text-secondary)",transition:"background 0.2s",marginLeft:"auto"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(158, 158, 158, 0.1)"},onMouseLeave:h=>{h.currentTarget.style.background="none"},children:e.jsx(Xe,{size:20})})]}),k&&t.images&&t.images.length>0&&e.jsx(Ft,{images:t.images,initialIndex:M,onClose:()=>b(!1)})]})},Nt=({authorId:t,avatarUrl:s})=>{const[o,l]=ce.useState(void 0),[d,n]=ce.useState(void 0);ce.useEffect(()=>{let j=!0;return(async()=>{try{const f=await We(t);if(!j||!f?.equippedFrame){l(void 0),n(void 0);return}const c=Le(f.equippedFrame);let x=c?.data.frameUrl;const S=c?.data.frameStyle,a="/life-pwa-react/";if(x)!x.startsWith("http://")&&!x.startsWith("https://")&&(x.startsWith(a)||(x=`${a}${x.replace(/^\//,"")}`)),console.log("[PostCard] ãƒ•ãƒ¬ãƒ¼ãƒ URL:",x);else{const p=[],y=[f.equippedFrame,c?.name||"",c?.id||""].filter(Boolean),w=["png","webp","jpg","jpeg"];for(const k of y){const b=k.toString().toLowerCase().replace(/\s+/g,"_").replace(/[\u3000]/g,"_");for(const M of w)p.push(`${a}frames/${b}.${M}`),p.push(`${a}frames/frame_${b}.${M}`)}console.log("[PostCard] ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒå€™è£œ:",p),x=await Ut(p),console.log("[PostCard] è¦‹ã¤ã‹ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒ:",x)}l(x||void 0),n(S)}catch(f){console.error("ãƒ•ãƒ¬ãƒ¼ãƒ å–å¾—ã‚¨ãƒ©ãƒ¼:",f)}})(),()=>{j=!1}},[t]);const r=40,i=48+17*2,m=(i-r)/2;return e.jsxs("div",{style:{position:"relative",width:`${i}px`,height:`${i}px`,marginRight:"12px",flexShrink:0},children:[o?e.jsx("img",{src:o,alt:"frame",style:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1}}):d?e.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:1,...d}}):null,e.jsx("div",{style:{position:"absolute",left:`${m}px`,top:`${m}px`,width:`${r}px`,height:`${r}px`,borderRadius:"0px",background:s?`url(${s}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)",zIndex:2}})]})};async function Ut(t){for(const s of t)if(await qt(s))return s}function qt(t){return new Promise(s=>{const o=new Image;o.onload=()=>s(!0),o.onerror=()=>s(!1),o.src=t})}const G=()=>e.jsxs("div",{style:{padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"var(--border)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{width:"120px",height:"16px",background:"var(--border)",borderRadius:"4px",marginBottom:"8px",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("div",{style:{width:"80px",height:"12px",background:"var(--border)",borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}})]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{width:"100%",height:"12px",background:"var(--border)",borderRadius:"4px",marginBottom:"8px",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("div",{style:{width:"80%",height:"12px",background:"var(--border)",borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}})]}),e.jsx("div",{style:{display:"flex",gap:"16px",marginTop:"12px"},children:[1,2,3,4].map(t=>e.jsx("div",{style:{width:"60px",height:"16px",background:"var(--border)",borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}},t))}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.5;
          }
        }
      `})]}),_t=({onPostClick:t,onUserClick:s})=>{const{user:o}=H(),[l,d]=g.useState([]),[n,r]=g.useState(!0),[u,i]=g.useState(""),[m,j]=g.useState(!1),[f,c]=g.useState(void 0),[x,S]=g.useState("all"),a=async(k=x)=>{r(!0),i("");try{if(k==="following"&&o){console.log("ğŸ“¡ Fetching following posts...");const b=await lt(o.uid,20);console.log(`âœ… Fetched ${b.length} following posts`),d(b)}else{console.log("ğŸ“¡ Fetching timeline posts...");const b=await ct(20);console.log(`âœ… Fetched ${b.length} posts`),d(b)}}catch(b){console.error("âŒ æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",b),console.error("Error details:",b.message,b.code),i(b.message||"ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{r(!1)}};g.useEffect(()=>{a(x)},[x,o]);const p=()=>{a()},y=k=>{c(k),j(!0)},w=()=>{j(!1),c(void 0)};return e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:0,zIndex:10},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:"var(--text)",margin:0},children:"ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>a(),disabled:n,style:{background:"none",border:"none",cursor:n?"not-allowed":"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",transition:"background 0.2s"},onMouseEnter:k=>{n||(k.currentTarget.style.background="var(--border)")},onMouseLeave:k=>{k.currentTarget.style.background="none"},children:e.jsx(dt,{size:24})}),e.jsx("button",{onClick:()=>j(!0),style:{background:"linear-gradient(135deg, var(--primary), #81c784)",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white",boxShadow:"0 2px 8px rgba(76, 175, 80, 0.3)",transition:"transform 0.2s"},onMouseEnter:k=>{k.currentTarget.style.transform="scale(1.05)"},onMouseLeave:k=>{k.currentTarget.style.transform="scale(1)"},children:e.jsx(he,{size:24})})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:"69px",zIndex:9},children:[e.jsx("button",{onClick:()=>S("all"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:x==="all"?"3px solid var(--primary)":"3px solid transparent",cursor:"pointer",fontSize:"15px",fontWeight:x==="all"?600:400,color:x==="all"?"var(--primary)":"var(--text-secondary)",transition:"all 0.2s"},children:"ã™ã¹ã¦"}),e.jsx("button",{onClick:()=>S("following"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:x==="following"?"3px solid var(--primary)":"3px solid transparent",cursor:"pointer",fontSize:"15px",fontWeight:x==="following"?600:400,color:x==="following"?"var(--primary)":"var(--text-secondary)",transition:"all 0.2s"},children:"ãƒ•ã‚©ãƒ­ãƒ¼ä¸­"})]}),e.jsx("div",{style:{padding:"16px"},children:u?e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",background:"#ffebee",borderRadius:"12px",margin:"20px 0"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"âš ï¸"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:600,color:"#c62828",marginBottom:"8px"},children:"ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"}),e.jsx("div",{style:{fontSize:"14px",color:"#d32f2f",marginBottom:"16px"},children:u}),e.jsx("button",{onClick:()=>a(),style:{padding:"10px 20px",background:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:600},children:"å†è©¦è¡Œ"})]}):n?e.jsxs("div",{children:[e.jsx(G,{}),e.jsx(G,{}),e.jsx(G,{})]}):l.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:x==="following"?"ğŸ‘¥":"ğŸ“"}),e.jsx("div",{style:{fontSize:"18px",fontWeight:600,marginBottom:"8px"},children:x==="following"?"ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“":"ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("div",{style:{fontSize:"14px",marginBottom:"24px"},children:"æœ€åˆã®æŠ•ç¨¿ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼"}),e.jsxs("button",{onClick:()=>j(!0),style:{padding:"12px 24px",background:"linear-gradient(135deg, var(--primary), #81c784)",color:"white",border:"none",borderRadius:"12px",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px",transition:"transform 0.2s"},onMouseEnter:k=>{k.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:k=>{k.currentTarget.style.transform="translateY(0)"},children:[e.jsx(he,{size:20}),"æŠ•ç¨¿ã‚’ä½œæˆ"]})]}):e.jsx("div",{children:l.map(k=>e.jsx(ae,{post:k,onPostClick:t,onUserClick:s,onQuoteRepost:y},k.id))})}),m&&e.jsx(Dt,{onClose:w,onPostCreated:p,quotedPostId:f})]})},Ot=({postId:t,onBack:s,onPostDeleted:o,onUserClick:l})=>{const{user:d}=H(),[n,r]=g.useState(null),[u,i]=g.useState([]),[m,j]=g.useState(!0),[f,c]=g.useState(!1),[x,S]=g.useState(0),[a,p]=g.useState(""),[y,w]=g.useState(!1),[k,b]=g.useState(null);g.useEffect(()=>{(async()=>{j(!0);try{const T=await Pe(t);if(T){if(r(T),S(T.likes),d){const U=await ke(t,d.uid);c(U);const Q=await Y(d.uid);b(Q)}const L=await pe(t);i(L)}else alert("æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),s()}catch(T){console.error("æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",T),alert("æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),s()}finally{j(!1)}})()},[t,s,d]);const M=async()=>{if(!(!d||!k))try{f?(await Se(t,d.uid),c(!1),S(Math.max(0,x-1))):(await ze(t,d.uid,k.displayName,k.avatarUrl),c(!0),S(x+1))}catch(v){console.error("ã„ã„ã­æ“ä½œã‚¨ãƒ©ãƒ¼:",v),alert("ã„ã„ã­æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ")}},C=async()=>{if(!(!d||!n||!a.trim()||!k))try{w(!0),await xt(t,d.uid,k.displayName,a.trim(),k.avatarUrl);const v=await pe(t);i(v),p("")}catch(v){console.error("ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã‚¨ãƒ©ãƒ¼:",v),alert("ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{w(!1)}},z=async v=>{if(!(!d||!confirm("ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")))try{await gt(t,v,d.uid);const T=await pe(t);i(T)}catch(T){console.error("ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",T),alert("ã‚³ãƒ¡ãƒ³ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}},W=async()=>{if(!(!d||!n)&&confirm("ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{await pt(t,d.uid),alert("æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),o()}catch(v){console.error("æŠ•ç¨¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:",v),alert("æŠ•ç¨¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}};if(m)return e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid var(--border)",borderTop:"4px solid var(--primary)",borderRadius:"50%",margin:"0 auto 16px",animation:"spin 1s linear infinite"}}),e.jsx("div",{children:"æŠ•ç¨¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™..."})]});if(!n)return null;const $=d&&n.authorId===d.uid;return e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:0,zIndex:10},children:[e.jsx("button",{onClick:s,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text)",transition:"background 0.2s"},onMouseEnter:v=>{v.currentTarget.style.background="var(--border)"},onMouseLeave:v=>{v.currentTarget.style.background="none"},children:e.jsx(de,{size:24})}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"var(--text)",margin:0},children:"æŠ•ç¨¿"}),$&&e.jsx("button",{onClick:W,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#f44336",transition:"background 0.2s"},onMouseEnter:v=>{v.currentTarget.style.background="#ffebee"},onMouseLeave:v=>{v.currentTarget.style.background="none"},children:e.jsx(Ce,{size:24})})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{onClick:()=>l(n.authorId),style:{display:"flex",alignItems:"center",marginBottom:"16px",cursor:"pointer",padding:"8px",marginLeft:"-8px",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:v=>{v.currentTarget.style.background="var(--border)"},onMouseLeave:v=>{v.currentTarget.style.background="none"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:n.authorAvatar?`url(${n.authorAvatar}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)",marginRight:"12px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)",fontSize:"16px"},children:n.authorName}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"14px"},children:K(n.createdAt)})]})]}),e.jsx("div",{style:{color:"var(--text)",fontSize:"16px",lineHeight:"1.6",marginBottom:"20px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n.content}),n.recipeData&&e.jsxs("div",{style:{marginBottom:"20px",padding:"20px",background:"linear-gradient(135deg, rgba(22, 163, 74, 0.05), rgba(129, 199, 132, 0.05))",borderRadius:"12px",border:"2px solid var(--primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"24px"},children:"ğŸ‘¨â€ğŸ³"}),e.jsx("div",{style:{fontWeight:700,fontSize:"18px",color:"var(--text)"},children:n.recipeData.title}),e.jsx("div",{style:{marginLeft:"auto",padding:"6px 16px",background:"var(--primary)",color:"white",borderRadius:"12px",fontSize:"14px",fontWeight:600},children:n.recipeData.difficulty==="easy"?"ç°¡å˜":n.recipeData.difficulty==="medium"?"æ™®é€š":"é›£ã—ã„"})]}),e.jsx("div",{style:{fontSize:"15px",color:"var(--text-secondary)",marginBottom:"12px"},children:n.recipeData.description}),e.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:"14px",color:"var(--text-secondary)",marginBottom:"16px"},children:[e.jsxs("span",{children:["ğŸ½ï¸ ",n.recipeData.servings,"äººåˆ†"]}),e.jsxs("span",{children:["â±ï¸ ",n.recipeData.preparationTime+n.recipeData.cookingTime,"åˆ†"]})]}),n.recipeData.ingredients&&n.recipeData.ingredients.length>0&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"15px",color:"var(--text)",marginBottom:"10px"},children:"ğŸ“ ææ–™"}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"14px",color:"var(--text)",lineHeight:"2"},children:n.recipeData.ingredients.map((v,T)=>e.jsx("li",{children:v},T))})]}),n.recipeData.instructions&&n.recipeData.instructions.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:"15px",color:"var(--text)",marginBottom:"10px"},children:"ğŸ‘¨â€ğŸ³ ä½œã‚Šæ–¹"}),e.jsx("ol",{style:{margin:0,paddingLeft:"20px",fontSize:"14px",color:"var(--text)",lineHeight:"2"},children:n.recipeData.instructions.map((v,T)=>e.jsx("li",{style:{marginBottom:"8px"},children:v},T))})]})]}),n.quotedPost&&e.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"var(--background)",borderRadius:"12px",border:"1px solid var(--border)"},children:[e.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"12px"},children:"å¼•ç”¨å…ƒã®æŠ•ç¨¿:"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:n.quotedPost.authorAvatar?`url(${n.quotedPost.authorAvatar}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text)"},children:n.quotedPost.authorName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:K(n.quotedPost.createdAt)})]})]}),e.jsx("div",{style:{fontSize:"15px",color:"var(--text)",lineHeight:"1.5",marginBottom:n.quotedPost.recipeData||n.quotedPost.images&&n.quotedPost.images.length>0?"12px":"0"},children:n.quotedPost.content}),n.quotedPost.recipeData&&e.jsxs("div",{style:{marginBottom:"12px",padding:"12px",background:"rgba(22, 163, 74, 0.05)",borderRadius:"8px",border:"1px solid var(--primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:"ğŸ‘¨â€ğŸ³"}),e.jsx("span",{style:{fontWeight:600,fontSize:"14px",color:"var(--text)"},children:n.quotedPost.recipeData.title})]}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:n.quotedPost.recipeData.description})]}),n.quotedPost.images&&n.quotedPost.images.length>0&&e.jsx("div",{style:{width:"100%",paddingBottom:"56.25%",position:"relative",borderRadius:"8px",overflow:"hidden",background:"var(--border)"},children:e.jsx("img",{src:n.quotedPost.images[0],alt:"å¼•ç”¨å…ƒç”»åƒ",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}})})]}),n.images&&n.images.length>0&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:n.images.length===1?"1fr":(n.images.length===2,"repeat(2, 1fr)"),gap:"12px",marginBottom:"24px"},children:n.images.map((v,T)=>e.jsx("div",{style:{width:"100%",paddingBottom:n.images.length===1?"56.25%":"100%",position:"relative",borderRadius:"12px",overflow:"hidden",background:"var(--border)"},children:e.jsx("img",{src:v,alt:`æŠ•ç¨¿ç”»åƒ ${T+1}`,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}})},T))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"32px",padding:"16px 0",borderTop:"1px solid var(--border)",borderBottom:"1px solid var(--border)"},children:[e.jsxs("button",{onClick:M,style:{background:"none",border:"none",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",padding:"8px 12px",borderRadius:"12px",color:f?"#e91e63":"var(--text-secondary)",transition:"background 0.2s",fontSize:"16px"},onMouseEnter:v=>{v.currentTarget.style.background="rgba(233, 30, 99, 0.1)"},onMouseLeave:v=>{v.currentTarget.style.background="none"},children:[f?e.jsx(ee,{size:24}):e.jsx(be,{size:24}),e.jsx("span",{style:{fontWeight:600},children:x})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--text-secondary)",fontSize:"16px"},children:[e.jsx(je,{size:24}),e.jsx("span",{style:{fontWeight:600},children:n.commentCount})]})]}),e.jsxs("div",{style:{marginTop:"24px"},children:[d&&e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"flex-end",padding:"12px",background:"var(--card)",borderRadius:"12px",border:"1px solid var(--border)"},children:[e.jsx("textarea",{value:a,onChange:v=>p(v.target.value),placeholder:"ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›...",style:{flex:1,padding:"12px",border:"1px solid var(--border)",borderRadius:"8px",background:"var(--background)",color:"var(--text)",fontFamily:"inherit",fontSize:"14px",resize:"vertical",minHeight:"44px",maxHeight:"120px",outline:"none"},onFocus:v=>{v.currentTarget.style.borderColor="var(--primary)"},onBlur:v=>{v.currentTarget.style.borderColor="var(--border)"}}),e.jsx("button",{onClick:C,disabled:y||!a.trim(),style:{background:a.trim()?"var(--primary)":"var(--border)",border:"none",color:a.trim()?"white":"var(--text-secondary)",padding:"12px 16px",borderRadius:"8px",cursor:a.trim()&&!y?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},children:e.jsx(Re,{size:20})})]})}),e.jsx("div",{style:{marginTop:"20px"},children:u.length>0?e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"16px",fontWeight:600,marginBottom:"16px",color:"var(--text)"},children:["ã‚³ãƒ¡ãƒ³ãƒˆ (",u.length,")"]}),u.map(v=>e.jsxs("div",{style:{padding:"12px",background:"var(--background)",borderRadius:"8px",marginBottom:"12px",borderLeft:"2px solid var(--primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)",fontSize:"14px"},children:v.userName}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:K(v.createdAt)})]}),d&&d.uid===v.userId&&e.jsx("button",{onClick:()=>z(v.id),style:{background:"none",border:"none",color:"#f44336",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",transition:"background 0.2s"},onMouseEnter:T=>{T.currentTarget.style.background="#ffebee"},onMouseLeave:T=>{T.currentTarget.style.background="none"},children:"å‰Šé™¤"})]}),e.jsx("div",{style:{color:"var(--text)",fontSize:"14px",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:v.content})]},v.id))]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 20px",color:"var(--text-secondary)",background:"var(--background)",borderRadius:"12px"},children:e.jsx("div",{style:{fontSize:"14px"},children:"ã‚³ãƒ¡ãƒ³ãƒˆã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“"})})})]})]})]})},Fe=async(t,s,o,l,d,n)=>{console.log(`[sendFriendRequest] Sending request: ${t} -> ${l}`);try{const r=le(R),u=new Date().toISOString(),i=A(R,`users/${t}/friends/${l}`);r.set(i,{uid:l,displayName:d,avatarUrl:n||"",status:"pending_sent",initiatedBy:t,createdAt:u});const m=A(R,`users/${l}/friends/${t}`);r.set(m,{uid:t,displayName:s,avatarUrl:o||"",status:"pending_received",initiatedBy:t,createdAt:u}),await r.commit(),await Te(l,t,s,"friend_request",{actorAvatar:o}),console.log(`âœ… [sendFriendRequest] Request sent: ${t} -> ${l}`)}catch(r){throw console.error("âŒ [sendFriendRequest] Failed to send request:",r),new Error(`ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}},Ne=async(t,s,o,l,d,n)=>{console.log(`[acceptFriendRequest] Accepting request: ${t} accepts ${l}`);try{const r=le(R),u=new Date().toISOString(),i=A(R,`users/${t}/friends/${l}`);r.update(i,{status:"accepted",acceptedAt:u});const m=A(R,`users/${l}/friends/${t}`);r.update(m,{status:"accepted",acceptedAt:u});const j=A(R,`users/${t}/profile/data`),f=A(R,`users/${l}/profile/data`);r.update(j,{"stats.friendCount":re(1)}),r.update(f,{"stats.friendCount":re(1)}),await r.commit(),await Te(l,t,s,"friend_accept",{actorAvatar:o});try{const{checkAndGrantTitles:c}=await ut(async()=>{const{checkAndGrantTitles:x}=await import("./index-ikSvfp_l.js").then(S=>S.br);return{checkAndGrantTitles:x}},__vite__mapDeps([0,1,2,3,4]));await Promise.all([c(t),c(l)])}catch(c){console.error("ç§°å·ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:",c)}console.log(`âœ… [acceptFriendRequest] Request accepted: ${t} accepts ${l}`)}catch(r){throw console.error("âŒ [acceptFriendRequest] Failed to accept request:",r),new Error(`ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}},Ue=async(t,s)=>{console.log(`[declineFriendRequest] Declining request: ${t} declines ${s}`);try{const o=le(R),l=A(R,`users/${t}/friends/${s}`);o.delete(l);const d=A(R,`users/${s}/friends/${t}`);o.delete(d),await o.commit(),console.log(`âœ… [declineFriendRequest] Request declined: ${t} declines ${s}`)}catch(o){throw console.error("âŒ [declineFriendRequest] Failed to decline request:",o),new Error(`ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ‹’å¦ã«å¤±æ•—ã—ã¾ã—ãŸ: ${o.message||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}},qe=async(t,s)=>{console.log(`[removeFriend] Removing friend: ${t} removes ${s}`);try{const o=le(R),l=A(R,`users/${t}/friends/${s}`);o.delete(l);const d=A(R,`users/${s}/friends/${t}`);o.delete(d);const n=A(R,`users/${t}/profile/data`),r=A(R,`users/${s}/profile/data`);o.update(n,{"stats.friendCount":re(-1)}),o.update(r,{"stats.friendCount":re(-1)}),await o.commit(),console.log(`âœ… [removeFriend] Friend removed: ${t} removes ${s}`)}catch(o){throw console.error("âŒ [removeFriend] Failed to remove friend:",o),new Error(`ãƒ•ãƒ¬ãƒ³ãƒ‰ã®è§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${o.message||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}},Ht=async(t,s)=>{try{if(t===s)return"not_friends";const o=A(R,`users/${t}/friends/${s}`),l=await ge(o);return l.exists()?l.data().status:"not_friends"}catch(o){return console.error("Check friend status error:",o),"not_friends"}},V=async(t,s)=>{try{const o=D(R,`users/${t}/friends`),l=s?O(o,E("status","==",s)):o,d=await _(l),n=[];for(const r of d.docs){const u=r.data(),i=await Y(u.uid);i?n.push({...u,...i}):n.push(u)}return n.sort((r,u)=>r.displayName.localeCompare(u.displayName))}catch(o){return console.error("Get friends error:",o),[]}},_e=async(t,s)=>{const o=[t,s].sort(),l=o.join("_"),d=A(R,"conversations",l);if((await ge(d)).exists())console.log("â„¹ï¸ Existing conversation found:",l);else{const r={id:l,participants:o,createdAt:new Date().toISOString(),unreadCount:{[t]:0,[s]:0}};await Ee(d,r),console.log("âœ… New conversation created:",l)}return l},Gt=(t,s)=>{const o=O(D(R,"conversations"),E("participants","array-contains",t),ne("lastMessageTimestamp","desc"));return $e(o,async l=>{const d=[];for(const n of l.docs){const r=n.data(),u=await Promise.all(r.participants.map(async i=>({uid:i,displayName:"Unknown",avatarUrl:void 0})));d.push({...r,participantProfiles:u})}s(d)},l=>{console.error("Error subscribing to conversations:",l),s([])})},Yt=async(t,s,o)=>{try{const l=D(R,"conversations",t,"messages"),d=A(l),n=new Date().toISOString(),r={id:d.id,senderId:s,content:o,timestamp:n,read:!1};await Ee(d,r);const u=A(R,"conversations",t),i=await ge(u);if(i.exists()){const j=i.data().participants.find(f=>f!==s);if(j){const f={lastMessage:o,lastMessageTimestamp:n,[`unreadCount.${j}`]:re(1)};await De(u,f)}}console.log("âœ… Message sent:",t,r.id)}catch(l){throw console.error("Error sending message:",l),l}},Vt=(t,s)=>{const o=O(D(R,"conversations",t,"messages"),ne("timestamp","asc"),J(100));return $e(o,l=>{const d=l.docs.map(n=>n.data());s(d)},l=>{console.error("Error subscribing to messages:",l),s([])})},Zt=({userId:t,onClose:s,onNavigateToProfile:o,onNavigateToDM:l,initialTab:d="friends"})=>{const{user:n}=H(),[r,u]=g.useState(d),[i,m]=g.useState([]),[j,f]=g.useState([]),[c,x]=g.useState([]),[S,a]=g.useState(!0),[p,y]=g.useState(null),w=n&&n.uid===t;g.useEffect(()=>{(async()=>{a(!0),y(null);try{const z=await V(t,"accepted");if(m(z),w){const W=await V(t,"pending_sent");f(W);const $=await V(t,"pending_received");x($)}}catch(z){console.error("Failed to fetch friend lists:",z),y("ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{a(!1)}})()},[t,w]);const k=async(C,z)=>{if(n)try{switch(C){case"send":await Fe(n.uid,n.displayName||"Anonymous",n.photoURL||void 0,z.uid,z.displayName,z.avatarUrl||void 0);break;case"accept":await Ne(n.uid,n.displayName||"Anonymous",n.photoURL||void 0,z.uid,z.displayName,z.avatarUrl||void 0);break;case"decline":await Ue(n.uid,z.uid);break;case"remove":await qe(n.uid,z.uid);break}const W=await V(t,"accepted");if(m(W),w){const $=await V(t,"pending_sent");f($);const v=await V(t,"pending_received");x(v)}}catch(W){console.error(`Failed to perform friend action ${C}:`,W),alert(`ãƒ•ãƒ¬ãƒ³ãƒ‰æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ: ${W instanceof Error?W.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}},b=async C=>{if(n)try{const z=await _e(n.uid,C);l(z,[n.uid,C]),s()}catch(z){console.error("Failed to start DM:",z),alert("DMã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚")}},M=C=>e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer"},onClick:()=>{o(C.uid),s()},children:[e.jsx("img",{src:C.avatarUrl||"https://via.placeholder.com/40",alt:C.displayName,style:{width:"40px",height:"40px",borderRadius:"50%",marginRight:"12px"}}),e.jsxs("div",{style:{flexGrow:1},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)"},children:C.displayName}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:["@",C.username]})]}),w&&C.status==="pending_received"&&e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:z=>{z.stopPropagation(),k("accept",C)},style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"20px",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},children:e.jsx(Be,{size:16})}),e.jsx("button",{onClick:z=>{z.stopPropagation(),k("decline",C)},style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:"20px",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},children:e.jsx(Z,{size:16})})]}),w&&C.status==="accepted"&&e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:z=>{z.stopPropagation(),k("remove",C)},style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:"20px",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},children:"è§£é™¤"}),e.jsxs("button",{onClick:z=>{z.stopPropagation(),b(C.uid)},style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"20px",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},children:[e.jsx(xe,{size:16})," DM"]})]}),!w&&C.status==="accepted"&&e.jsxs("button",{onClick:z=>{z.stopPropagation(),b(C.uid)},style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"20px",padding:"6px 12px",fontSize:"13px",cursor:"pointer"},children:[e.jsx(xe,{size:16})," DM"]}),w&&C.status==="pending_sent"&&e.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"ç”³è«‹ä¸­"})]},C.uid);return S?e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"var(--card)",borderRadius:"8px",width:"90%",maxWidth:"500px",maxHeight:"80%",overflowY:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,color:"var(--text)"},children:"èª­ã¿è¾¼ã¿ä¸­..."}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",color:"var(--text-secondary)",fontSize:"24px",cursor:"pointer"},children:e.jsx(Z,{})})]}),e.jsx("div",{style:{padding:"16px",textAlign:"center",color:"var(--text-secondary)"},children:"ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­..."})]})}):p?e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"var(--card)",borderRadius:"8px",width:"90%",maxWidth:"500px",maxHeight:"80%",overflowY:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,color:"var(--text)"},children:"ã‚¨ãƒ©ãƒ¼"}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",color:"var(--text-secondary)",fontSize:"24px",cursor:"pointer"},children:e.jsx(Z,{})})]}),e.jsx("div",{style:{padding:"16px",textAlign:"center",color:"var(--text-secondary)"},children:p})]})}):e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"var(--card)",borderRadius:"8px",width:"90%",maxWidth:"500px",maxHeight:"80%",overflowY:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,color:"var(--text)"},children:"ãƒ•ãƒ¬ãƒ³ãƒ‰"}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",color:"var(--text-secondary)",fontSize:"24px",cursor:"pointer"},children:e.jsx(Z,{})})]}),w&&e.jsxs("div",{style:{display:"flex",borderBottom:"1px solid var(--border)"},children:[e.jsxs("button",{onClick:()=>u("friends"),style:{flex:1,padding:"12px",background:"none",border:"none",borderBottom:r==="friends"?"2px solid var(--primary)":"2px solid transparent",color:r==="friends"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",fontSize:"14px"},children:["ãƒ•ãƒ¬ãƒ³ãƒ‰ (",i.length,")"]}),e.jsxs("button",{onClick:()=>u("pending_received"),style:{flex:1,padding:"12px",background:"none",border:"none",borderBottom:r==="pending_received"?"2px solid var(--primary)":"2px solid transparent",color:r==="pending_received"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",fontSize:"14px"},children:["ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (",c.length,")"]}),e.jsxs("button",{onClick:()=>u("pending_sent"),style:{flex:1,padding:"12px",background:"none",border:"none",borderBottom:r==="pending_sent"?"2px solid var(--primary)":"2px solid transparent",color:r==="pending_sent"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",fontSize:"14px"},children:["é€ä¿¡æ¸ˆã¿ (",j.length,")"]})]}),e.jsxs("div",{style:{flexGrow:1,overflowY:"auto"},children:[r==="friends"&&(i.length>0?i.map(M):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"ãƒ•ãƒ¬ãƒ³ãƒ‰ã¯ã„ã¾ã›ã‚“ã€‚"})),r==="pending_received"&&(c.length>0?c.map(M):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"å—ä¿¡ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"})),r==="pending_sent"&&(j.length>0?j.map(M):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"é€ä¿¡æ¸ˆã¿ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"}))]})]})})},Kt=({userId:t,onBack:s,onPostClick:o,onUserClick:l,onNavigateToDM:d})=>{const{user:n}=H(),[r,u]=g.useState(null),[i,m]=g.useState([]),[j,f]=g.useState(null),[c,x]=g.useState(!0),[S,a]=g.useState(!1),[p,y]=g.useState(null),[w,k]=g.useState("not_friends"),[b,M]=g.useState("posts"),[C,z]=g.useState(!1),[W,$]=g.useState("friends"),[v,T]=g.useState(null),L=n&&n.uid===t;g.useEffect(()=>{(async()=>{x(!0),y(null);try{const I=await we(t);T(I);const q=await Y(t);if(!q){y("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");return}if(u(q),n&&n.uid!==t){const F=await Ht(n.uid,t);k(F)}}catch(I){console.error("[UserProfileScreen] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",I),y(I instanceof Error?I.message:"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{x(!1)}})()},[t,n]),g.useEffect(()=>{(async()=>{if(r){a(!0);try{let I=[];switch(b){case"posts":if(I=await wt(t,20),r.pinnedPostId){const q=await Pe(r.pinnedPostId);f(q),I=I.filter(F=>F.id!==r.pinnedPostId)}else f(null);break;case"media":I=await kt(t,20),f(null);break;case"likes":I=await jt(t,20),f(null);break;case"replies":I=await bt(t,20),f(null);break}m(I)}catch(I){console.error(`[UserProfileScreen] ${b}æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:`,I)}finally{a(!1)}}})()},[t,b,r]);const U=async B=>{if(!n||!r)return;const I=w,q={...r};try{switch(B){case"send":k("pending_sent"),await Fe(n.uid,n.displayName||"Anonymous",n.photoURL||void 0,t,r.displayName,r.avatarUrl||void 0);break;case"accept":k("accepted"),u({...r,stats:{...r.stats,friendCount:r.stats.friendCount+1}}),await Ne(n.uid,n.displayName||"Anonymous",n.photoURL||void 0,t,r.displayName,r.avatarUrl||void 0);break;case"decline":k("not_friends"),await Ue(n.uid,t);break;case"remove":k("not_friends"),u({...r,stats:{...r.stats,friendCount:r.stats.friendCount-1}}),await qe(n.uid,t);break}}catch(F){console.error("DUMPING FULL FRIEND ACTION ERROR:",F),k(I),u(q);const h=F instanceof Error?F.message:"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼";alert(`ãƒ•ãƒ¬ãƒ³ãƒ‰æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸ.

ã‚¨ãƒ©ãƒ¼: ${h}`)}},Q=async()=>{if(!(!n||!r))try{const B=await _e(n.uid,r.uid);d(B,[n.uid,r.uid])}catch(B){console.error("Failed to start DM:",B),alert("DMã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}},oe=async()=>{try{const B=await Y(t);B&&u(B)}catch(B){console.error("[UserProfileScreen] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®å†å–å¾—ã«å¤±æ•—:",B)}};return c?e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)"},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:"var(--border)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("div",{style:{width:"120px",height:"18px",background:"var(--border)",borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("div",{style:{width:"24px"}})]}),e.jsx("div",{style:{width:"100%",height:"150px",background:"var(--border)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsxs("div",{style:{padding:"0 20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",marginTop:"-40px",marginBottom:"12px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"var(--border)",border:"4px solid var(--card)",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("div",{style:{width:"100px",height:"32px",background:"var(--border)",borderRadius:"20px",animation:"pulse 1.5s ease-in-out infinite"}})]}),e.jsx("div",{style:{width:"150px",height:"20px",background:"var(--border)",borderRadius:"4px",marginBottom:"8px",animation:"pulse 1.5s ease-in-out infinite"}}),e.jsx("div",{style:{width:"100px",height:"14px",background:"var(--border)",borderRadius:"4px",marginBottom:"16px",animation:"pulse 1.5s ease-in-out infinite"}})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx(G,{}),e.jsx(G,{})]}),e.jsx("style",{children:"@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }"})]}):p||!r?e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"âš ï¸"}),e.jsx("div",{style:{fontSize:"16px",color:"var(--text)",marginBottom:"16px"},children:p||"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),e.jsx("button",{onClick:s,style:{padding:"10px 20px",background:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:600},children:"æˆ»ã‚‹"})]}):e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:0,zIndex:10},children:[e.jsx("button",{onClick:s,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text)",transition:"background 0.2s"},onMouseEnter:B=>{B.currentTarget.style.background="var(--border)"},onMouseLeave:B=>{B.currentTarget.style.background="none"},children:e.jsx(de,{size:24})}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"var(--text)",margin:0},children:r.displayName}),e.jsx("div",{style:{width:"40px"}})]}),e.jsx("div",{style:{width:"100%",height:"150px",background:r.coverUrl?`url(${r.coverUrl}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)"}}),e.jsxs("div",{style:{padding:"0 20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",marginTop:"-40px",marginBottom:"12px"},children:[e.jsx(Jt,{userId:r.uid,avatarUrl:r.avatarUrl||void 0}),L?e.jsxs("div",{style:{padding:"8px 16px",background:"var(--card)",border:"2px solid var(--border)",borderRadius:"20px",color:"var(--text-secondary)",fontSize:"13px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(ht,{size:14}),"è¨­å®šç”»é¢ã‹ã‚‰ç·¨é›†ã§ãã¾ã™"]}):e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[w==="not_friends"&&e.jsxs("button",{onClick:()=>U("send"),style:{padding:"8px 16px",background:"var(--primary)",border:"none",borderRadius:"20px",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},children:[e.jsx(ft,{size:16})," ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹"]}),w==="pending_sent"&&e.jsx("button",{disabled:!0,style:{padding:"8px 16px",background:"var(--card)",border:"2px solid var(--border)",borderRadius:"20px",color:"var(--text-secondary)",fontSize:"14px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:"ç”³è«‹ä¸­"}),w==="pending_received"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>U("accept"),style:{padding:"8px 16px",background:"var(--primary)",border:"none",borderRadius:"20px",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},children:[e.jsx(Be,{size:16})," æ‰¿èª"]}),e.jsxs("button",{onClick:()=>U("decline"),style:{padding:"8px 16px",background:"var(--card)",border:"2px solid var(--border)",borderRadius:"20px",color:"var(--text)",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},children:[e.jsx(Z,{size:16})," æ‹’å¦"]})]}),w==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Q,style:{padding:"8px 16px",background:"var(--primary)",border:"none",borderRadius:"20px",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},children:[e.jsx(Me,{size:16})," ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"]}),e.jsx("button",{onClick:()=>U("remove"),style:{padding:"8px 16px",background:"var(--card)",border:"2px solid var(--border)",borderRadius:"20px",color:"var(--text)",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},children:"ãƒ•ãƒ¬ãƒ³ãƒ‰è§£é™¤"})]})]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"4px"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:"var(--text)"},children:r.displayName}),v&&e.jsx(me,{title:v,size:"medium",showName:!0})]}),e.jsxs("div",{style:{fontSize:"14px",color:"var(--text-secondary)"},children:["@",r.username]})]}),r.bio&&e.jsx("div",{style:{fontSize:"14px",color:"var(--text)",lineHeight:"1.5",marginBottom:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:r.bio}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px"},children:[r.websiteUrl&&e.jsxs("a",{href:r.websiteUrl,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"6px",fontSize:"14px",color:"var(--primary)",textDecoration:"none"},children:[e.jsx(yt,{size:16}),r.websiteUrl.startsWith("https://")?r.websiteUrl.substring(8):r.websiteUrl.startsWith("http://")?r.websiteUrl.substring(7):r.websiteUrl]}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",fontSize:"14px",color:"var(--text-secondary)"},children:[e.jsx(vt,{size:16}),mt(r.createdAt)]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:700,color:"var(--text)",marginRight:"4px"},children:te(r.stats.postCount)}),e.jsx("span",{style:{fontSize:"14px",color:"var(--text-secondary)"},children:"æŠ•ç¨¿"})]}),e.jsxs("div",{onClick:()=>{z(!0),$("friends")},style:{cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"background 0.2s"},onMouseEnter:B=>{B.currentTarget.style.background="var(--border)"},onMouseLeave:B=>{B.currentTarget.style.background="transparent"},children:[e.jsx("span",{style:{fontWeight:700,color:"var(--text)",marginRight:"4px"},children:te(r.stats.friendCount)}),e.jsx("span",{style:{fontSize:"14px",color:"var(--text-secondary)"},children:"ãƒ•ãƒ¬ãƒ³ãƒ‰"})]})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:"69px",zIndex:9},children:[e.jsx("button",{onClick:()=>M("posts"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:b==="posts"?"3px solid var(--primary)":"3px solid transparent",cursor:"pointer",fontSize:"15px",fontWeight:b==="posts"?600:400,color:b==="posts"?"var(--primary)":"var(--text-secondary)",transition:"all 0.2s"},children:"æŠ•ç¨¿"}),e.jsx("button",{onClick:()=>M("replies"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:b==="replies"?"3px solid var(--primary)":"3px solid transparent",cursor:"pointer",fontSize:"15px",fontWeight:b==="replies"?600:400,color:b==="replies"?"var(--primary)":"var(--text-secondary)",transition:"all 0.2s"},children:"è¿”ä¿¡"}),e.jsx("button",{onClick:()=>M("media"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:b==="media"?"3px solid var(--primary)":"3px solid transparent",cursor:"pointer",fontSize:"15px",fontWeight:b==="media"?600:400,color:b==="media"?"var(--primary)":"var(--text-secondary)",transition:"all 0.2s"},children:"ãƒ¡ãƒ‡ã‚£ã‚¢"}),e.jsx("button",{onClick:()=>M("likes"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:b==="likes"?"3px solid var(--primary)":"3px solid transparent",cursor:"pointer",fontSize:"15px",fontWeight:b==="likes"?600:400,color:b==="likes"?"var(--primary)":"var(--text-secondary)",transition:"all 0.2s"},children:"ã„ã„ã­"})]}),e.jsx("div",{style:{marginTop:"0"},children:S?e.jsxs("div",{children:[e.jsx(G,{}),e.jsx(G,{})]}):i.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:b==="media"?"ğŸ“·":b==="likes"?"â¤ï¸":b==="replies"?"ğŸ’¬":"ğŸ“"}),e.jsxs("div",{style:{fontSize:"16px"},children:[b==="posts"&&(L?"ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“":"ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã¾ã æŠ•ç¨¿ã—ã¦ã„ã¾ã›ã‚“"),b==="replies"&&(L?"è¿”ä¿¡ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“":"ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã¾ã è¿”ä¿¡ã—ã¦ã„ã¾ã›ã‚“"),b==="media"&&(L?"ç”»åƒä»˜ãæŠ•ç¨¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“":"ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã¾ã ç”»åƒã‚’æŠ•ç¨¿ã—ã¦ã„ã¾ã›ã‚“"),b==="likes"&&(L?"ã¾ã ã„ã„ã­ã—ãŸæŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“":"ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã„ã„ã­ã¯éå…¬é–‹ã§ã™")]})]}):e.jsxs("div",{children:[b==="posts"&&j&&e.jsx(ae,{post:j,onPostClick:o,onUserClick:l,showPinButton:!!L,onPinToggle:oe},j.id),i.map(B=>e.jsx(ae,{post:B,onPostClick:o,onUserClick:l,showPinButton:!!L&&b==="posts",onPinToggle:oe},B.id))]})}),C&&e.jsx(Zt,{userId:t,onClose:()=>z(!1),onNavigateToProfile:l,onNavigateToDM:()=>{},initialTab:W})]})},Jt=({userId:t,avatarUrl:s})=>{const[o,l]=g.useState(void 0),[d,n]=g.useState(void 0);g.useEffect(()=>{let j=!0;return(async()=>{try{const f=await We(t);if(!j||!f?.equippedFrame){l(void 0),n(void 0);return}const c=Le(f.equippedFrame);let x=c?.data.frameUrl;const S=c?.data.frameStyle,a="/life-pwa-react/";if(x)!x.startsWith("http://")&&!x.startsWith("https://")&&(x.startsWith(a)||(x=`${a}${x.replace(/^\//,"")}`)),console.log("[UserProfile] ãƒ•ãƒ¬ãƒ¼ãƒ URL:",x);else{const p=[],y=[f.equippedFrame,c?.name||"",c?.id||""].filter(Boolean),w=["png","webp","jpg","jpeg"];for(const k of y){const b=k.toString().toLowerCase().replace(/\s+/g,"_").replace(/[\u3000]/g,"_");for(const M of w)p.push(`${a}frames/${b}.${M}`),p.push(`${a}frames/frame_${b}.${M}`)}console.log("[UserProfile] ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒå€™è£œ:",p),x=await Qt(p),console.log("[UserProfile] è¦‹ã¤ã‹ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒ:",x)}l(x||void 0),n(S)}catch(f){console.error("ãƒ•ãƒ¬ãƒ¼ãƒ å–å¾—ã‚¨ãƒ©ãƒ¼:",f)}})(),()=>{j=!1}},[t]);const r=68,i=80+21*2,m=(i-r)/2;return e.jsxs("div",{style:{position:"relative",width:`${i}px`,height:`${i}px`},children:[o?e.jsx("img",{src:o,alt:"frame",style:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1}}):d?e.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:1,...d}}):null,e.jsx("div",{style:{position:"absolute",left:`${m}px`,top:`${m}px`,width:`${r}px`,height:`${r}px`,borderRadius:"0px",background:s?`url(${s}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)",zIndex:2}})]})};async function Qt(t){for(const s of t)if(await Xt(s))return s}function Xt(t){return new Promise(s=>{const o=new Image;o.onload=()=>s(!0),o.onerror=()=>s(!1),o.src=t})}const er=async(t,s=20)=>{try{if(!t.trim())return[];const o=D(R,"users"),l=[],d=O(o,E("username",">=",t.toLowerCase()),E("username","<=",t.toLowerCase()+"ï£¿"),J(s)),n=await _(d);for(const i of n.docs){const m=await _(D(i.ref,"profile"));if(!m.empty){const j=m.docs[0].data();l.push(j)}}const r=O(o,E("displayName",">=",t),E("displayName","<=",t+"ï£¿"),J(s)),u=await _(r);for(const i of u.docs){const m=await _(D(i.ref,"profile"));if(!m.empty){const j=m.docs[0].data();l.find(f=>f.uid===j.uid)||l.push(j)}}return l.slice(0,s)}catch(o){return console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã‚¨ãƒ©ãƒ¼:",o),[]}},tr=async(t,s=20)=>{try{if(!t.trim())return[];const o=D(R,"posts"),l=O(o,E("visibility","==","public"),ne("createdAt","desc"),J(100)),d=await _(l),n=[];return d.forEach(r=>{const u=r.data(),i={id:r.id,content:u.content,images:u.images||[],authorId:u.authorId,authorName:u.authorName,authorAvatar:u.authorAvatar||"",likes:u.likes||0,commentCount:u.commentCount||0,repostCount:u.repostCount||0,hashtags:u.hashtags||[],visibility:u.visibility,createdAt:u.createdAt?.toDate?.()?.toISOString()||u.createdAt,updatedAt:u.updatedAt?.toDate?.()?.toISOString()||u.updatedAt},m=t.toLowerCase();(i.content.toLowerCase().includes(m)||i.authorName.toLowerCase().includes(m))&&n.push(i)}),n.slice(0,s)}catch(o){return console.error("æŠ•ç¨¿æ¤œç´¢ã‚¨ãƒ©ãƒ¼:",o),[]}},ye=async(t,s=20)=>{try{if(!t.trim())return[];const o=t.startsWith("#")?t.slice(1):t,l=D(R,"posts"),d=O(l,E("visibility","==","public"),E("hashtags","array-contains",o),ne("createdAt","desc"),J(s)),n=await _(d),r=[];return n.forEach(u=>{const i=u.data();r.push({id:u.id,content:i.content,images:i.images||[],authorId:i.authorId,authorName:i.authorName,authorAvatar:i.authorAvatar||"",likes:i.likes||0,commentCount:i.commentCount||0,repostCount:i.repostCount||0,hashtags:i.hashtags||[],visibility:i.visibility,createdAt:i.createdAt?.toDate?.()?.toISOString()||i.createdAt,updatedAt:i.updatedAt?.toDate?.()?.toISOString()||i.updatedAt})}),r}catch(o){return console.error("ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æ¤œç´¢ã‚¨ãƒ©ãƒ¼:",o),[]}},rr=t=>{const s=["ã®","ã«","ã¯","ã‚’","ãŸ","ãŒ","ã§","ã¦","ã¨","ã—","ã‚Œ","ã•","ã‚ã‚‹","ã„ã‚‹","ã‚‚","ã™ã‚‹","ã‹ã‚‰","ãª","ã“ã¨","ã¨ã—ã¦","ã„","ã‚„","ã‚Œã‚‹","ãªã©","ãªã£","ãªã„","ã“ã®","ãŸã‚","ãã®","ã‚ã£","ã‚ˆã†","ã¾ãŸ","ã‚‚ã®","ã¨ã„ã†","ã‚ã‚Š","ã¾ã§","ã‚‰ã‚Œ","ãªã‚‹","ã¸","ã‹","ã ","ã“ã‚Œ","ã«ã‚ˆã£ã¦","ã«ã‚ˆã‚Š","ãŠã‚Š","ã‚ˆã‚Š","ã«ã‚ˆã‚‹","ãš","ãªã‚Š","ã‚‰ã‚Œã‚‹","ã«ãŠã„ã¦","ã°","ãªã‹ã£","ãªã","ã—ã‹ã—","ã«ã¤ã„ã¦","ã›","ã ã£","ãã®å¾Œ","ã§ãã‚‹","ãã‚Œ","ã†","ã®ã§","ãªãŠ","ã®ã¿","ã§ã","ã","ã¤","ã«ãŠã‘ã‚‹","ãŠã‚ˆã³","ã„ã†","ã•ã‚‰ã«","ã§ã‚‚","ã‚‰","ãŸã‚Š","ãã®ä»–","ã«é–¢ã™ã‚‹","ãŸã¡","ã¾ã™","ã‚“","ãªã‚‰","ã«å¯¾ã—ã¦","ç‰¹ã«","ã›ã‚‹","åŠã³","ã“ã‚Œã‚‰","ã¨ã","ã§ã¯","ã«ã¦","ã»ã‹","ãªãŒã‚‰","ã†ã¡","ãã—ã¦","ã¨ã‚‚","ã¨ã—ã¦","ã®ã‹","ã®ã«","ã»ã©","ã‚‚ã®ã®","ã¨ã„ã†","ã¨ã“ã‚","ã«ã‚ˆã‚‹","ã‚‚ã‚“","ã§ã™","ã¾ã—ãŸ","ã§ã—ãŸ","ã‚ã‚‹","ã„ã‚‹","ã™ã‚‹","ãªã‚‹","ãã‚‹","ã‚„ã‚‹","ã„ã","ã§ãã‚‹","ãªã‚‰","ã ã‚","ã§ã—ã‚‡","ã§ã™","ã¾ã™","ã¾ã›ã‚“","ã¾ã—ã‚‡","ãªã‚Š","ãŸã„","ãŸã‚‰","ãªãã¦","ãªã‘ã‚Œ"];let o=t.replace(/https?:\/\/[^\s]+/g,"");o=o.replace(/@[a-zA-Z0-9_]+/g,""),o=o.replace(/#[^\s]+/g,""),o=o.replace(/[!-/:-@[-`{-~ã€ã€‚ï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰]/g," ");const l=o.split(/\s+/).filter(i=>i.length>0),d=[],n=/[ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾ ã€…]+/g,r=o.match(n);r&&r.forEach(i=>{i.length>=2&&(s.includes(i)||d.push(i))});const u=l.filter(i=>i.match(/^[a-zA-Z0-9]+$/)&&i.length>=3);return[...d,...u]},Oe=async(t=10)=>{try{const s=D(R,"posts"),o=O(s,E("visibility","==","public"),ne("createdAt","desc"),J(200)),l=await _(o),d={};return l.forEach(r=>{const u=r.data();(u.hashtags||[]).forEach(f=>{d[`#${f}`]=(d[`#${f}`]||0)+2});const m=u.content||"";rr(m).forEach(f=>{d[f]=(d[f]||0)+1})}),Object.entries(d).map(([r,u])=>({tag:r,count:u})).sort((r,u)=>u.count-r.count).slice(0,t)}catch(s){return console.error("ãƒˆãƒ¬ãƒ³ãƒ‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:",s),[]}},nr=({onPostClick:t,onUserClick:s})=>{const[o,l]=g.useState(""),[d,n]=g.useState("all"),[r,u]=g.useState([]),[i,m]=g.useState([]),[j,f]=g.useState([]),[c,x]=g.useState(!1);g.useEffect(()=>{(async()=>{const y=await Oe(10);f(y)})()},[]);const S=async()=>{if(o.trim()){x(!0);try{if(o.startsWith("#")){const p=await ye(o,20);m(p),u([]),n("hashtags")}else{const[p,y]=await Promise.all([er(o,10),tr(o,20)]);u(p),m(y),n("all")}}catch(p){console.error("æ¤œç´¢ã‚¨ãƒ©ãƒ¼:",p)}finally{x(!1)}}},a=async p=>{l(`#${p}`),x(!0);try{const y=await ye(p,20);m(y),u([]),n("hashtags")}catch(y){console.error("ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°æ¤œç´¢ã‚¨ãƒ©ãƒ¼:",y)}finally{x(!1)}};return e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsx("div",{style:{padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:0,zIndex:10},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",background:"var(--background)",padding:"12px 16px",borderRadius:"24px",border:"1px solid var(--border)"},children:[e.jsx(Ie,{size:24,style:{color:"var(--text-secondary)"}}),e.jsx("input",{type:"text",placeholder:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€æŠ•ç¨¿ã€#ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’æ¤œç´¢",value:o,onChange:p=>l(p.target.value),onKeyDown:p=>{p.key==="Enter"&&S()},style:{flex:1,border:"none",background:"none",outline:"none",color:"var(--text)",fontSize:"15px",fontFamily:"inherit"}}),e.jsx("button",{onClick:S,style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"16px",padding:"6px 16px",fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"opacity 0.2s"},onMouseEnter:p=>{p.currentTarget.style.opacity="0.9"},onMouseLeave:p=>{p.currentTarget.style.opacity="1"},children:"æ¤œç´¢"})]})}),o&&e.jsx("div",{style:{display:"flex",borderBottom:"1px solid var(--border)",background:"var(--card)"},children:["all","users","posts","hashtags"].map(p=>e.jsxs("button",{onClick:()=>n(p),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:d===p?"2px solid var(--primary)":"2px solid transparent",color:d===p?"var(--primary)":"var(--text-secondary)",fontWeight:d===p?600:400,cursor:"pointer",transition:"all 0.2s",fontSize:"15px"},children:[p==="all"&&"ã™ã¹ã¦",p==="users"&&"ãƒ¦ãƒ¼ã‚¶ãƒ¼",p==="posts"&&"æŠ•ç¨¿",p==="hashtags"&&"ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°"]},p))}),c&&e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid var(--border)",borderTop:"4px solid var(--primary)",borderRadius:"50%",margin:"0 auto 16px",animation:"spin 1s linear infinite"}}),e.jsx("div",{children:"æ¤œç´¢ä¸­..."})]}),!c&&o&&e.jsxs("div",{style:{padding:"20px"},children:[(d==="all"||d==="users")&&r.length>0&&e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,marginBottom:"16px",color:"var(--text)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(St,{size:24}),"ãƒ¦ãƒ¼ã‚¶ãƒ¼ (",r.length,")"]}),r.map(p=>e.jsxs("div",{onClick:()=>s(p.uid),style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:"var(--card)",borderRadius:"12px",marginBottom:"8px",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},onMouseEnter:y=>{y.currentTarget.style.transform="translateY(-2px)",y.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.15)"},onMouseLeave:y=>{y.currentTarget.style.transform="translateY(0)",y.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:p.avatarUrl?`url(${p.avatarUrl}) center/cover`:"linear-gradient(135deg, var(--primary), #81c784)"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--text)",fontSize:"15px"},children:p.displayName}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"14px"},children:["@",p.username]}),p.bio&&e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",marginTop:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.bio})]})]},p.uid))]}),(d==="all"||d==="posts"||d==="hashtags")&&i.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,marginBottom:"16px",color:"var(--text)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(zt,{size:24}),"æŠ•ç¨¿ (",i.length,")"]}),i.map(p=>e.jsx(ae,{post:p,onPostClick:t,onUserClick:s},p.id))]}),r.length===0&&i.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"16px",marginBottom:"8px"},children:"æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),e.jsx("div",{style:{fontSize:"14px"},children:"åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„"})]})]}),!o&&!c&&e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,marginBottom:"16px",color:"var(--text)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ie,{size:24}),"ãƒˆãƒ¬ãƒ³ãƒ‰"]}),j.map((p,y)=>e.jsxs("div",{onClick:()=>a(p.tag),style:{padding:"16px",background:"var(--card)",borderRadius:"12px",marginBottom:"8px",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},onMouseEnter:w=>{w.currentTarget.style.transform="translateY(-2px)",w.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.15)"},onMouseLeave:w=>{w.currentTarget.style.transform="translateY(0)",w.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"},children:[e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"4px"},children:[y+1,"ä½ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰"]}),e.jsxs("div",{style:{fontSize:"16px",fontWeight:600,color:"var(--text)",marginBottom:"4px"},children:["#",p.tag]}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:[p.count,"ä»¶ã®æŠ•ç¨¿"]})]},p.tag))]})]})},or=({onNavigateToPost:t,onNavigateToProfile:s})=>{const{user:o}=H(),[l,d]=g.useState([]),[n,r]=g.useState(!0),[u,i]=g.useState(!1);g.useEffect(()=>{if(!o)return;const c=Ct(o.uid,x=>{d(At(x)),r(!1)});return()=>c()},[o]);const m=async c=>{if(o){if(!c.isRead)try{await It(o.uid,c.latestNotification.id)}catch(x){console.error("Error marking notification as read:",x)}c.type==="follow"?c.actors.length===1&&s&&s(c.actors[0].id):c.postId&&t&&t(c.postId)}},j=async()=>{if(o)try{await Bt(o.uid),i(!1)}catch(c){console.error("Error marking all as read:",c),alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}},f=async()=>{if(o&&confirm("å…¨ã¦ã®é€šçŸ¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{await Mt(o.uid),i(!1)}catch(c){console.error("Error deleting all notifications:",c),alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}};return n?e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:e.jsx("p",{style:{color:"var(--text-secondary)"},children:"èª­ã¿è¾¼ã¿ä¸­..."})}):l.length===0?e.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[e.jsx(Ae,{size:64,style:{color:"var(--text-secondary)",marginBottom:"16px"}}),e.jsx("h2",{style:{color:"var(--text)",marginBottom:"8px"},children:"é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{style:{color:"var(--text-secondary)"},children:"ã„ã„ã­ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã€ãƒ•ã‚©ãƒ­ãƒ¼ãªã©ã®é€šçŸ¥ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™"})]}):e.jsxs("div",{style:{minHeight:"100vh"},children:[e.jsxs("div",{style:{position:"sticky",top:0,background:"var(--background)",borderBottom:"1px solid var(--border)",padding:"16px",display:"flex",justifyContent:"space-between",alignItems:"center",zIndex:10},children:[e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"bold"},children:"é€šçŸ¥"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{onClick:()=>i(!u),style:{background:"transparent",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text)"},onMouseEnter:c=>{c.currentTarget.style.background="var(--hover)"},onMouseLeave:c=>{c.currentTarget.style.background="transparent"},children:e.jsx(ve,{size:24})}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>i(!1)}),e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,background:"var(--card)",border:"1px solid var(--border)",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"200px",zIndex:1e3,overflow:"hidden"},children:[e.jsxs("button",{onClick:j,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",textAlign:"left",cursor:"pointer",color:"var(--text)",display:"flex",alignItems:"center",gap:"12px"},onMouseEnter:c=>{c.currentTarget.style.background="var(--hover)"},onMouseLeave:c=>{c.currentTarget.style.background="transparent"},children:[e.jsx(Rt,{size:20}),"ã™ã¹ã¦æ—¢èª­ã«ã™ã‚‹"]}),e.jsxs("button",{onClick:f,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",textAlign:"left",cursor:"pointer",color:"#ef4444",display:"flex",alignItems:"center",gap:"12px"},onMouseEnter:c=>{c.currentTarget.style.background="var(--hover)"},onMouseLeave:c=>{c.currentTarget.style.background="transparent"},children:[e.jsx(Ce,{size:20}),"ã™ã¹ã¦å‰Šé™¤"]})]})]})]})]}),e.jsx("div",{children:l.map(c=>e.jsx("div",{onClick:()=>m(c),style:{padding:"16px",borderBottom:"1px solid var(--border)",cursor:"pointer",background:c.isRead?"transparent":"rgba(29, 155, 240, 0.05)",transition:"background 0.2s"},onMouseEnter:x=>{x.currentTarget.style.background=c.isRead?"var(--hover)":"rgba(29, 155, 240, 0.1)"},onMouseLeave:x=>{x.currentTarget.style.background=c.isRead?"transparent":"rgba(29, 155, 240, 0.05)"},children:e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"var(--primary)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",flexShrink:0},children:Pt(c.type)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[c.actors.length<=3?e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:c.actors.map(x=>e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:x.avatar?`url(${x.avatar})`:"var(--primary)",backgroundSize:"cover",backgroundPosition:"center",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold",border:"2px solid var(--background)"},children:!x.avatar&&x.name.charAt(0).toUpperCase()},x.id))}):e.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[c.actors.slice(0,3).map(x=>e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:x.avatar?`url(${x.avatar})`:"var(--primary)",backgroundSize:"cover",backgroundPosition:"center",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold",border:"2px solid var(--background)"},children:!x.avatar&&x.name.charAt(0).toUpperCase()},x.id)),c.count>3&&e.jsxs("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"var(--text-secondary)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold"},children:["+",c.count-3]})]}),e.jsx("p",{style:{margin:"0 0 8px 0",color:"var(--text)",fontSize:"15px"},children:Tt(c)}),c.latestNotification.postContent&&e.jsx("p",{style:{margin:"0 0 8px 0",color:"var(--text-secondary)",fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.latestNotification.postContent}),c.latestNotification.commentContent&&e.jsxs("p",{style:{margin:"0 0 8px 0",color:"var(--text-secondary)",fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["ğŸ’¬ ",c.latestNotification.commentContent]}),e.jsx("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"13px"},children:K(c.latestNotification.createdAt)})]})]})},`${c.type}_${c.postId||c.actors[0].id}_${c.latestNotification.id}`))})]})},He=({conversationId:t,participants:s,onBack:o,onNavigateToProfile:l})=>{const{user:d}=H(),[n,r]=g.useState([]),[u,i]=g.useState(""),[m,j]=g.useState(null),f=g.useRef(null),c=s.find(a=>a!==d?.uid);g.useEffect(()=>{if(!c)return;(async()=>{const p=await Y(c);p&&j({displayName:p.displayName,avatarUrl:p.avatarUrl})})()},[c]),g.useEffect(()=>{const a=Vt(t,p=>{r(p)});return()=>a()},[t]),g.useEffect(()=>{f.current?.scrollIntoView({behavior:"smooth"})},[n]),g.useEffect(()=>{if(!d)return;(async()=>{const p=A(R,"conversations",t);await De(p,{[`unreadCount.${d.uid}`]:0})})()},[t,d]);const x=async()=>{if(!(u.trim()===""||!d))try{await Yt(t,d.uid,u),i("")}catch(a){console.error("Failed to send message:",a),alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}},S=a=>new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"var(--background)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:0,zIndex:10},children:[e.jsx("button",{onClick:o,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text)",transition:"background 0.2s"},onMouseEnter:a=>{a.currentTarget.style.background="var(--border)"},onMouseLeave:a=>{a.currentTarget.style.background="none"},children:e.jsx(de,{size:24})}),e.jsx("img",{src:m?.avatarUrl||"https://via.placeholder.com/40",alt:m?.displayName,style:{width:"40px",height:"40px",borderRadius:"50%",marginLeft:"12px",cursor:"pointer"},onClick:()=>l(c)}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"var(--text)",margin:"0 0 0 12px",flexGrow:1},children:m?.displayName||"Unknown User"})]}),e.jsxs("div",{style:{flexGrow:1,overflowY:"auto",padding:"16px",display:"flex",flexDirection:"column",gap:"10px"},children:[n.map(a=>e.jsx("div",{style:{display:"flex",justifyContent:a.senderId===d?.uid?"flex-end":"flex-start"},children:e.jsxs("div",{style:{maxWidth:"70%",padding:"10px 15px",borderRadius:"18px",backgroundColor:a.senderId===d?.uid?"var(--primary)":"var(--card)",color:a.senderId===d?.uid?"white":"var(--text)",wordBreak:"break-word",fontSize:"15px",position:"relative"},children:[a.content,e.jsx("span",{style:{fontSize:"10px",color:a.senderId===d?.uid?"rgba(255,255,255,0.7)":"var(--text-secondary)",position:"absolute",bottom:"5px",right:a.senderId===d?.uid?"10px":"auto",left:a.senderId===d?.uid?"auto":"10px"},children:S(a.timestamp)})]})},a.id)),e.jsx("div",{ref:f})]}),e.jsxs("div",{style:{display:"flex",padding:"10px 16px",borderTop:"1px solid var(--border)",background:"var(--card)",alignItems:"center"},children:[e.jsx("input",{type:"text",value:u,onChange:a=>i(a.target.value),onKeyPress:a=>{a.key==="Enter"&&x()},placeholder:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...",style:{flexGrow:1,padding:"10px 15px",border:"1px solid var(--border)",borderRadius:"20px",marginRight:"10px",fontSize:"15px",backgroundColor:"var(--background)",color:"var(--text)"}}),e.jsx("button",{onClick:x,style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"background 0.2s"},children:e.jsx(Re,{size:24})})]})]})},sr=({onBack:t,onNavigateToProfile:s})=>{const{user:o}=H(),[l,d]=g.useState([]),[n,r]=g.useState(!0),[u,i]=g.useState(null),[m,j]=g.useState(null),[f,c]=g.useState([]);g.useEffect(()=>{if(!o){i("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚"),r(!1);return}r(!0),i(null);const a=Gt(o.uid,async p=>{const y=await Promise.all(p.map(async w=>{const k=await Promise.all(w.participants.map(async b=>{const M=await Y(b);return{uid:b,displayName:M?.displayName||"Unknown",avatarUrl:M?.avatarUrl}}));return{...w,participantProfiles:k}}));d(y),r(!1)});return()=>a()},[o]);const x=(a,p)=>{j(a),c(p)},S=()=>{j(null),c([])};return m&&f.length>0?e.jsx(He,{conversationId:m,participants:f,onBack:S,onNavigateToProfile:s}):n?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"ä¼šè©±ã‚’èª­ã¿è¾¼ã¿ä¸­..."}):u?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--error)"},children:u}):e.jsxs("div",{style:{paddingBottom:"80px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"16px 20px",background:"var(--card)",borderBottom:"1px solid var(--border)",position:"sticky",top:0,zIndex:10},children:[e.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text)",transition:"background 0.2s"},onMouseEnter:a=>{a.currentTarget.style.background="var(--border)"},onMouseLeave:a=>{a.currentTarget.style.background="none"},children:e.jsx(de,{size:24})}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"var(--text)",margin:"0 0 0 16px"},children:"DM"})]}),l.length===0?e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx(xe,{size:60,style:{marginBottom:"16px"}}),e.jsx("p",{children:"ã¾ã ä¼šè©±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"}),e.jsx("p",{children:"ãƒ•ãƒ¬ãƒ³ãƒ‰ã¨DMã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼"})]}):l.map(a=>{const p=a.participantProfiles?.find(w=>w.uid!==o?.uid),y=o&&a.unreadCount?a.unreadCount[o.uid]:0;return e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid var(--border)",cursor:"pointer",backgroundColor:y>0?"rgba(29, 155, 240, 0.05)":"transparent"},onClick:()=>x(a.id,a.participants),children:[e.jsx("img",{src:p?.avatarUrl||"https://via.placeholder.com/40",alt:p?.displayName,style:{width:"50px",height:"50px",borderRadius:"50%",marginRight:"12px"}}),e.jsxs("div",{style:{flexGrow:1,overflow:"hidden"},children:[e.jsx("div",{style:{fontWeight:y>0?700:600,color:"var(--text)"},children:p?.displayName||"Unknown User"}),e.jsx("div",{style:{fontSize:"14px",color:y>0?"var(--text)":"var(--text-secondary)",fontWeight:y>0?"bold":"normal",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:a.lastMessage||"ä¼šè©±ã‚’é–‹å§‹"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginLeft:"10px"},children:[a.lastMessageTimestamp&&e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px"},children:new Date(a.lastMessageTimestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),y>0&&e.jsx("div",{style:{backgroundColor:"var(--primary)",color:"white",borderRadius:"10px",padding:"0 6px",fontSize:"12px",fontWeight:"bold"},children:y})]})]},a.id)})]})},ir=({onPostClick:t})=>{const[s,o]=g.useState("posts"),[l,d]=g.useState([]),[n,r]=g.useState([]),[u,i]=g.useState([]),[m,j]=g.useState(!0),[f,c]=g.useState(null);g.useEffect(()=>{(async()=>{j(!0),c(null);try{if(console.log(`[RankingScreen] Fetching rankings for tab: ${s}`),s==="posts"){const a=await Wt(10);console.log(`[RankingScreen] Got ${a.length} posts`),d(a)}else if(s==="recipes"){const a=await Lt(10);console.log(`[RankingScreen] Got ${a.length} recipes`),r(a)}else if(s==="hashtags"){const a=await Oe(20);console.log(`[RankingScreen] Got ${a.length} hashtags`),i(a)}}catch(a){console.error("ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—ã‚¨ãƒ©ãƒ¼:",a);const p=a instanceof Error?a.message:"ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";c(p)}finally{j(!1)}})()},[s]);const x=(S,a,p)=>{const y=["#FFD700","#C0C0C0","#CD7F32"],w=S<=3?y[S-1]:void 0;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:"var(--card)",borderRadius:"8px",border:"1px solid var(--border)",marginBottom:"8px",transition:"transform 0.2s ease, box-shadow 0.2s ease",cursor:p!=="hashtag"?"pointer":"default"},onMouseEnter:k=>{p!=="hashtag"&&(k.currentTarget.style.transform="translateY(-2px)",k.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)")},onMouseLeave:k=>{p!=="hashtag"&&(k.currentTarget.style.transform="translateY(0)",k.currentTarget.style.boxShadow="none")},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:w||"var(--background)",color:w?"white":"var(--text)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:"14px",flexShrink:0},children:S}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:"var(--text)",marginBottom:"4px"},children:a.name||a.title||a.tag}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",fontSize:"13px",color:"var(--text-secondary)"},children:[p==="hashtag"&&e.jsxs("span",{children:[e.jsx($t,{size:14,style:{marginRight:"4px",verticalAlign:"middle"}}),a.count,"å›ä½¿ç”¨"]}),(p==="post"||p==="recipe")&&e.jsxs("span",{children:[e.jsx(ee,{size:14,style:{marginRight:"4px",verticalAlign:"middle",color:"#ef4444"}}),a.likes||0,"ã„ã„ã­"]})]})]})]},`${p}-${S}`)};return e.jsxs("div",{style:{padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",borderBottom:"2px solid var(--border)"},children:[e.jsxs("button",{onClick:()=>o("posts"),style:{flex:1,padding:"12px",background:"none",border:"none",borderBottom:s==="posts"?"3px solid var(--primary)":"3px solid transparent",color:s==="posts"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",fontSize:"14px",fontWeight:s==="posts"?600:400,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx(ee,{size:18}),"äººæ°—æŠ•ç¨¿"]}),e.jsxs("button",{onClick:()=>o("recipes"),style:{flex:1,padding:"12px",background:"none",border:"none",borderBottom:s==="recipes"?"3px solid var(--primary)":"3px solid transparent",color:s==="recipes"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",fontSize:"14px",fontWeight:s==="recipes"?600:400,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx(fe,{size:18}),"äººæ°—ãƒ¬ã‚·ãƒ”"]}),e.jsxs("button",{onClick:()=>o("hashtags"),style:{flex:1,padding:"12px",background:"none",border:"none",borderBottom:s==="hashtags"?"3px solid var(--primary)":"3px solid transparent",color:s==="hashtags"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",fontSize:"14px",fontWeight:s==="hashtags"?600:400,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx(ie,{size:18}),"ãƒˆãƒ¬ãƒ³ãƒ‰"]})]}),m&&e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{width:"40px",height:"40px",margin:"0 auto 12px",border:"3px solid var(--border)",borderTopColor:"var(--primary)",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),"èª­ã¿è¾¼ã¿ä¸­..."]}),f&&e.jsx("div",{style:{padding:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",borderRadius:"8px",textAlign:"center",marginBottom:"16px"},children:f}),!m&&!f&&e.jsxs(e.Fragment,{children:[s==="posts"&&e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,marginBottom:"16px",color:"var(--text)"},children:[e.jsx(ee,{size:20,style:{marginRight:"8px",verticalAlign:"middle",color:"#ef4444"}}),"ã„ã„ã­æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°"]}),l.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--text-secondary)"},children:"æŠ•ç¨¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“"}):e.jsx("div",{children:l.map((S,a)=>e.jsx("div",{onClick:()=>t(S.id),children:x(a+1,{name:S.content.substring(0,50),likes:S.likes},"post")},S.id))})]}),s==="recipes"&&e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,marginBottom:"16px",color:"var(--text)"},children:[e.jsx(fe,{size:20,style:{marginRight:"8px",verticalAlign:"middle"}}),"äººæ°—ãƒ¬ã‚·ãƒ”ãƒ©ãƒ³ã‚­ãƒ³ã‚°"]}),n.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--text-secondary)"},children:"ãƒ¬ã‚·ãƒ”ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“"}):e.jsx("div",{children:n.map((S,a)=>e.jsx("div",{children:x(a+1,{title:S.title,likes:S.likes},"recipe")},S.id))})]}),s==="hashtags"&&e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,marginBottom:"16px",color:"var(--text)"},children:[e.jsx(ie,{size:20,style:{marginRight:"8px",verticalAlign:"middle",color:"#f59e0b"}}),"ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°"]}),u.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--text-secondary)"},children:"ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“"}):e.jsx("div",{children:u.map((S,a)=>e.jsx("div",{children:x(a+1,{tag:S.tag,count:S.count},"hashtag")},S.tag))})]})]})]})},ur=()=>{const[t,s]=g.useState("timeline"),[o,l]=g.useState("main"),[d,n]=g.useState(null),[r,u]=g.useState(null),[i,m]=g.useState(null),[j,f]=g.useState([]),c=y=>{n(y),l("post-detail")},x=y=>{u(y),l("profile")},S=(y,w)=>{m(y),f(w),l("chat")},a=()=>{l("main"),n(null),u(null),m(null),f([])},p=()=>{l("main"),n(null)};return o==="chat"&&i?e.jsx(He,{conversationId:i,participants:j,onBack:a,onNavigateToProfile:x}):o==="profile"&&r?e.jsx(Kt,{userId:r,onBack:a,onPostClick:c,onUserClick:x,onNavigateToDM:S}):o==="post-detail"&&d?e.jsx(Ot,{postId:d,onBack:a,onPostDeleted:p,onUserClick:x}):e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",borderBottom:"1px solid var(--border)",background:"var(--card)",position:"sticky",top:0,zIndex:10},children:[e.jsxs("button",{onClick:()=>s("timeline"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:t==="timeline"?"2px solid var(--primary)":"2px solid transparent",color:t==="timeline"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"15px",fontWeight:t==="timeline"?600:400},children:[e.jsx(Et,{size:20}),"ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³"]}),e.jsxs("button",{onClick:()=>s("search"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:t==="search"?"2px solid var(--primary)":"2px solid transparent",color:t==="search"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"15px",fontWeight:t==="search"?600:400},children:[e.jsx(Ie,{size:20}),"æ¤œç´¢"]}),e.jsxs("button",{onClick:()=>s("notifications"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:t==="notifications"?"2px solid var(--primary)":"2px solid transparent",color:t==="notifications"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"15px",fontWeight:t==="notifications"?600:400},children:[e.jsx(Ae,{size:20}),"é€šçŸ¥"]}),e.jsxs("button",{onClick:()=>s("dm"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:t==="dm"?"2px solid var(--primary)":"2px solid transparent",color:t==="dm"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"15px",fontWeight:t==="dm"?600:400},children:[e.jsx(Me,{size:20}),"DM"]}),e.jsxs("button",{onClick:()=>s("ranking"),style:{flex:1,padding:"16px",background:"none",border:"none",borderBottom:t==="ranking"?"2px solid var(--primary)":"2px solid transparent",color:t==="ranking"?"var(--primary)":"var(--text-secondary)",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"15px",fontWeight:t==="ranking"?600:400},children:[e.jsx(ie,{size:20}),"ãƒ©ãƒ³ã‚­ãƒ³ã‚°"]})]}),t==="timeline"&&e.jsx(_t,{onPostClick:c,onUserClick:x}),t==="search"&&e.jsx(nr,{onPostClick:c,onUserClick:x}),t==="notifications"&&e.jsx(or,{onNavigateToPost:c,onNavigateToProfile:x}),t==="dm"&&e.jsx(sr,{onBack:a,onNavigateToProfile:x}),t==="ranking"&&e.jsx(ir,{onPostClick:c,onUserClick:x})]})};export{ur as SocialScreen};
