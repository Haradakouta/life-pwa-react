import{r as y,j as e,d as R}from"./ui-vendor-JVI_EMCz.js";import{as as O,$ as Y,M as T,at as A,o as S,au as M,ab as W,Y as L,ac as U,aq as J,U as _,z as q}from"./index-S_7h3L6f.js";import{R as K,P as G,c as H,d as Q,T as V,e as X}from"./chart-vendor-FnQjAE1u.js";import"./react-vendor-Bzgz95E1.js";import"./firebase-vendor-CBmCTztv.js";const E=({selectedYear:x,selectedMonth:s,selectedDate:n,onSelectDate:p,onMonthChange:a,mode:i="month"})=>{const[d,g]=y.useState(x),[c,f]=y.useState(s),h=new Date(d,c,0).getDate(),v=new Date(d,c-1,1).getDay(),m=()=>{let o=c-1,u=d;o<1&&(o=12,u-=1),f(o),g(u),a&&a(u,o)},j=()=>{let o=c+1,u=d;o>12&&(o=1,u+=1),f(o),g(u),a&&a(u,o)},r=o=>{if(i==="date"&&p){const u=new Date(d,c-1,o);p(u)}},l=()=>{i==="month"&&a&&a(d,c)},t=o=>{const u=new Date;return u.getFullYear()===d&&u.getMonth()+1===c&&u.getDate()===o},b=o=>n?n.getFullYear()===d&&n.getMonth()+1===c&&n.getDate()===o:!1,w=[];for(let o=0;o<v;o++)w.push(null);for(let o=1;o<=h;o++)w.push(o);const N=["日","月","火","水","木","金","土"];return e.jsxs("div",{style:{background:"var(--card)",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsx("button",{onClick:m,style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:e.jsx(O,{size:24})}),e.jsxs("div",{onClick:l,style:{fontSize:"18px",fontWeight:"bold",cursor:i==="month"?"pointer":"default",padding:i==="month"?"8px 16px":"0",borderRadius:"8px",transition:"background 0.2s",background:i==="month"&&d===x&&c===s?"var(--primary)":"transparent",color:i==="month"&&d===x&&c===s?"white":"var(--text)"},children:[d,"年 ",c,"月"]}),e.jsx("button",{onClick:j,style:{background:"var(--primary)",color:"white",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:e.jsx(Y,{size:24})})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"8px",marginBottom:"10px"},children:N.map((o,u)=>e.jsx("div",{style:{textAlign:"center",fontSize:"12px",fontWeight:"bold",color:u===0?"#ef4444":u===6?"#3b82f6":"var(--text-secondary)"},children:o},u))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"8px"},children:w.map((o,u)=>{if(o===null)return e.jsx("div",{},`empty-${u}`);const z=t(o),k=b(o),B=u%7;return e.jsx("button",{onClick:()=>r(o),disabled:i==="month",style:{aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",border:z?"2px solid var(--primary)":"none",borderRadius:"8px",background:k?"var(--primary)":z?"var(--background)":"transparent",color:k?"white":B===0?"#ef4444":B===6?"#3b82f6":"var(--text)",fontSize:"14px",fontWeight:k||z?"bold":"normal",cursor:i==="date"?"pointer":"default",transition:"all 0.2s"},onMouseEnter:D=>{i==="date"&&!k&&(D.currentTarget.style.background="var(--background)")},onMouseLeave:D=>{i==="date"&&!k&&(D.currentTarget.style.background="transparent")},children:o},o)})}),i==="date"&&e.jsx("div",{style:{marginTop:"15px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:n?`選択: ${n.getFullYear()}/${n.getMonth()+1}/${n.getDate()}`:"日付を選択してください"})]})},Z=({isOpen:x,selectedDate:s,onClose:n,onConfirm:p})=>{const[a,i]=R.useState(s);if(R.useEffect(()=>{i(s)},[s,x]),!x)return null;const d=()=>{p(a),n()};return e.jsx("div",{className:"modal-backdrop",onClick:n,style:{animation:"fadeIn 0.2s ease"},children:e.jsxs("div",{className:"modal-content",onClick:g=>g.stopPropagation(),style:{maxWidth:"400px",animation:"slideUp 0.3s ease"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{margin:0},children:"日付を選択"}),e.jsx("button",{onClick:n,style:{background:"transparent",border:"none",cursor:"pointer",color:"var(--text-secondary)",padding:"5px",display:"flex",alignItems:"center"},children:e.jsx(T,{size:24})})]}),e.jsx(E,{selectedYear:a.getFullYear(),selectedMonth:a.getMonth()+1,selectedDate:a,onSelectDate:i,mode:"date"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{onClick:n,style:{flex:1,padding:"12px",background:"var(--background)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:"8px",cursor:"pointer",fontSize:"16px"},children:"キャンセル"}),e.jsxs("button",{onClick:d,className:"submit",style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"5px"},children:[e.jsx(A,{size:20}),"決定"]})]})]})})},ee=()=>{const{addExpense:x}=S(),[s,n]=y.useState("food"),[p,a]=y.useState(""),[i,d]=y.useState(""),[g,c]=y.useState(""),[f,h]=y.useState(new Date),[v,m]=y.useState(!1),j=[{value:"food",label:"食費"},{value:"transport",label:"交通費"},{value:"utilities",label:"光熱費"},{value:"entertainment",label:"娯楽"},{value:"health",label:"医療"},{value:"other",label:"その他"}],r=()=>{if(!i||Number(i)<=0){alert("正しい金額を入力してください");return}if(s==="other"&&!p.trim()){alert("カスタムカテゴリ名を入力してください");return}x({category:s,customCategory:s==="other"?p.trim():void 0,amount:Number(i),memo:g||void 0,date:f.toISOString()}),d(""),c(""),a(""),alert("支出を記録しました！")},l=t=>`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`;return e.jsxs("div",{className:"card",children:[e.jsx("label",{children:"日付"}),e.jsxs("button",{onClick:()=>m(!0),style:{width:"100%",padding:"12px",background:"var(--background)",color:"var(--text)",border:"2px solid var(--border)",borderRadius:"8px",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"15px"},children:[e.jsx("span",{children:l(f)}),e.jsx(M,{size:20,color:"var(--primary)"})]}),e.jsx("label",{children:"カテゴリ"}),e.jsx("select",{value:s,onChange:t=>n(t.target.value),children:j.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),s==="other"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"カスタムカテゴリ名"}),e.jsx("input",{value:p,onChange:t=>a(t.target.value),placeholder:"例: 趣味、ペット、書籍"})]}),e.jsx("label",{children:"金額(円)"}),e.jsx("input",{type:"number",value:i,onChange:t=>d(t.target.value),placeholder:"1000",min:"0"}),e.jsx("label",{children:"メモ（任意）"}),e.jsx("input",{value:g,onChange:t=>c(t.target.value),placeholder:"例: 昼食"}),e.jsxs("button",{className:"submit",onClick:r,children:[e.jsx(W,{size:20}),"記録する"]}),e.jsx(Z,{isOpen:v,selectedDate:f,onClose:()=>m(!1),onConfirm:h})]})},I=({isOpen:x,selectedYear:s,selectedMonth:n,onClose:p,onConfirm:a})=>{if(!x)return null;const i=(d,g)=>{a(d,g),p()};return e.jsx("div",{className:"modal-backdrop",onClick:p,style:{animation:"fadeIn 0.2s ease"},children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),style:{maxWidth:"400px",animation:"slideUp 0.3s ease"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",paddingBottom:"15px",borderBottom:"1px solid var(--border)"},children:[e.jsx("h3",{style:{margin:0},children:"月を選択"}),e.jsx("button",{onClick:p,style:{background:"transparent",border:"none",cursor:"pointer",color:"var(--text-secondary)",padding:"5px",display:"flex",alignItems:"center"},children:e.jsx(T,{size:24})})]}),e.jsx(E,{selectedYear:s,selectedMonth:n,onMonthChange:i,mode:"month"}),e.jsx("div",{style:{marginTop:"15px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"年月をタップして選択してください"})]})})},te=()=>{const{getTotalByMonth:x}=S(),{settings:s}=L(),[n,p]=y.useState(new Date().getFullYear()),[a,i]=y.useState(new Date().getMonth()+1),[d,g]=y.useState(!1),c=s.monthlyBudget??3e4,f=x(n,a),h=f/c*100,v=c-f,m=t=>new Intl.NumberFormat("ja-JP").format(t),r=h>=100?{color:"#ef4444",icon:e.jsx(U,{size:24}),message:"予算超過"}:h>=80?{color:"#f59e0b",icon:e.jsx(J,{size:24}),message:"予算残りわずか"}:{color:"#10b981",icon:e.jsx(_,{size:24}),message:"順調"},l=(t,b)=>{p(t),i(b)};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"15px"},children:"月次予算"}),e.jsxs("button",{onClick:()=>g(!0),style:{width:"100%",padding:"12px",background:"var(--background)",color:"var(--text)",border:"2px solid var(--border)",borderRadius:"8px",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsxs("span",{children:[n,"年 ",a,"月"]}),e.jsx(M,{size:20,color:"var(--primary)"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"15px",background:"var(--background)",borderRadius:"8px",marginBottom:"20px"},children:[e.jsx("div",{style:{color:r.color},children:r.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",color:r.color},children:r.message}),e.jsx("div",{style:{fontSize:"14px",color:"var(--text-secondary)",marginTop:"4px"},children:v>=0?`残り ¥${m(v)}`:`超過 ¥${m(Math.abs(v))}`})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",color:r.color},children:[h.toFixed(1),"%"]})})]}),e.jsxs("div",{style:{background:"var(--background)",borderRadius:"8px",overflow:"hidden",height:"40px",position:"relative",marginBottom:"15px"},children:[e.jsx("div",{style:{background:`linear-gradient(90deg, ${r.color}, ${r.color}dd)`,height:"100%",width:`${Math.min(h,100)}%`,transition:"width 0.3s ease"}}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontWeight:"bold",color:h>50?"white":"var(--text)",fontSize:"14px"},children:["¥",m(f)," / ¥",m(c)]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[e.jsxs("div",{style:{padding:"12px",background:"var(--background)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"5px"},children:"支出"}),e.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"var(--danger)"},children:["¥",m(f)]})]}),e.jsxs("div",{style:{padding:"12px",background:"var(--background)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"5px"},children:"予算"}),e.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"var(--primary)"},children:["¥",m(c)]})]})]}),e.jsx(I,{isOpen:d,selectedYear:n,selectedMonth:a,onClose:()=>g(!1),onConfirm:l})]})},C=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#6366f1"],P=["#ec4899","#14b8a6","#f97316","#a855f7","#06b6d4","#84cc16","#f43f5e","#0ea5e9","#eab308","#22c55e","#d946ef","#64748b"],$=x=>{if(!x)return C[5];let s=0;for(let p=0;p<x.length;p++)s=x.charCodeAt(p)+((s<<5)-s),s=s&s;const n=Math.abs(s)%P.length;return P[n]},F=x=>({food:C[0],transport:C[1],utilities:C[2],entertainment:C[3],health:C[4],other:C[5]})[x]||C[5],re=()=>{const{getTotalByCategory:x,getExpensesByMonth:s}=S(),[n,p]=y.useState(new Date().getFullYear()),[a,i]=y.useState(new Date().getMonth()+1),[d,g]=y.useState(!1),c=[{value:"food",label:"食費"},{value:"transport",label:"交通費"},{value:"utilities",label:"光熱費"},{value:"entertainment",label:"娯楽"},{value:"health",label:"医療"}],f=s(n,a),h=y.useMemo(()=>{const r=new Map;return c.forEach(l=>{const t=x(l.value,n,a);t>0&&r.set(l.value,{name:l.label,value:t,color:F(l.value)})}),f.forEach(l=>{if(l.category==="other"&&l.customCategory){const t=`custom_${l.customCategory}`,b=r.get(t);b?b.value+=l.amount:r.set(t,{name:l.customCategory,value:l.amount,color:$(l.customCategory)})}}),Array.from(r.values())},[n,a,f,x]),v=h.reduce((r,l)=>r+l.value,0),m=r=>new Intl.NumberFormat("ja-JP").format(r),j=(r,l)=>{p(r),i(l)};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"15px"},children:"カテゴリ別集計"}),e.jsxs("button",{onClick:()=>g(!0),style:{width:"100%",padding:"12px",background:"var(--background)",color:"var(--text)",border:"2px solid var(--border)",borderRadius:"8px",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[e.jsxs("span",{children:[n,"年 ",a,"月"]}),e.jsx(M,{size:20,color:"var(--primary)"})]}),f.length===0?e.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"20px"},children:"この月の支出データがありません"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:"var(--background)",padding:"15px",borderRadius:"8px",marginBottom:"20px",textAlign:"center"},children:[e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"14px",marginBottom:"5px"},children:"合計支出"}),e.jsxs("div",{style:{fontSize:"28px",fontWeight:"bold",color:"var(--danger)"},children:["¥",m(v)]})]}),h.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{width:"100%",height:250,children:e.jsxs(G,{children:[e.jsx(H,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:r=>`${r.name}: ¥${m(r.value)}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:h.map((r,l)=>e.jsx(Q,{fill:r.color},`cell-${l}`))}),e.jsx(V,{formatter:r=>`¥${m(r)}`,contentStyle:{background:"var(--card)",border:"1px solid var(--border)",borderRadius:"8px"}}),e.jsx(X,{})]})}),e.jsx("div",{style:{marginTop:"20px"},children:h.map((r,l)=>{const t=(r.value/v*100).toFixed(1);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:l<h.length-1?"1px solid var(--border)":"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"4px",background:r.color}}),e.jsx("span",{children:r.name})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:["¥",m(r.value)]}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[t,"%"]})]})]},l)})})]})]}),e.jsx(I,{isOpen:d,selectedYear:n,selectedMonth:a,onClose:()=>g(!1),onConfirm:j})]})},ne=()=>{const{deleteExpense:x,getExpensesByMonth:s}=S(),[n,p]=y.useState(new Date().getFullYear()),[a,i]=y.useState(new Date().getMonth()+1),[d,g]=y.useState(!1),c=s(n,a),f={food:"食費",transport:"交通費",utilities:"光熱費",entertainment:"娯楽",health:"医療",other:"その他"},h=t=>t.category==="other"&&t.customCategory?t.customCategory:f[t.category],v=t=>t.category==="other"&&t.customCategory?$(t.customCategory):F(t.category),m=t=>{window.confirm("この支出を削除しますか？")&&x(t)},j=t=>{const b=new Date(t);return`${b.getMonth()+1}/${b.getDate()}`},r=t=>new Intl.NumberFormat("ja-JP").format(t),l=(t,b)=>{p(t),i(b)};return e.jsxs("div",{className:"card",children:[e.jsxs("button",{onClick:()=>g(!0),style:{width:"100%",padding:"12px",background:"var(--background)",color:"var(--text)",border:"2px solid var(--border)",borderRadius:"8px",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"15px"},children:[e.jsxs("span",{children:[n,"年 ",a,"月"]}),e.jsx(M,{size:20,color:"var(--primary)"})]}),c.length===0?e.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"20px"},children:"この月の支出はまだありません"}):e.jsx("div",{className:"list",children:c.sort((t,b)=>new Date(b.date).getTime()-new Date(t.date).getTime()).map(t=>e.jsxs("div",{className:"list-item",children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("span",{style:{background:v(t),color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"12px"},children:h(t)}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"14px"},children:j(t.date)})]}),t.memo&&e.jsx("div",{style:{color:"var(--text)",fontSize:"14px",marginTop:"4px"},children:t.memo})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:"bold",color:"var(--danger)"},children:["¥",r(t.amount)]}),e.jsx("button",{className:"delete",onClick:()=>m(t.id),style:{padding:"8px"},children:e.jsx(q,{size:20})})]})]},t.id))}),e.jsx(I,{isOpen:d,selectedYear:n,selectedMonth:a,onClose:()=>g(!1),onConfirm:l})]})},de=()=>e.jsxs("section",{className:"screen active",children:[e.jsx("h2",{children:"家計簿"}),e.jsx(te,{}),e.jsx(ee,{}),e.jsx(re,{}),e.jsx("h3",{children:"支出履歴"}),e.jsx(ne,{})]});export{de as ExpenseScreen};
