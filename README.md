# 健康家計アプリ (Health & Finance PWA) 🥗💰

**AIがあなたの健康と家計をサポートする、オールインワン生活管理アプリ**

[![Access App](https://img.shields.io/badge/Access-Web%20App-4CAF50?style=for-the-badge&logo=pwa)](https://oshi-para.web.app/)

> **📱 今すぐ使う:** [https://oshi-para.web.app/](https://oshi-para.web.app/)
>
> **💡 ヒント:** iOS(Safari)またはAndroid(Chrome)で「ホーム画面に追加」することで、アプリとしてインストールできます。

---

## 🌟 なぜこのアプリ？

「健康管理」と「家計管理」を別々のアプリで行うのは面倒ではありませんか？
このアプリは、日々の**食事記録**がそのまま**食費管理**になり、**買い物リスト**が**在庫管理**に連動します。
さらに、Googleの最新AI（Gemini）があなたの専属アドバイザーとして、食事内容や買い物の傾向から健康的なアドバイスを提供します。

---

## ✨ 主な機能

### 1. 📸 撮るだけ管理
- **バーコードスキャン:** 商品バーコードを読み取るだけで、カロリーと商品情報を自動取得。そのまま在庫や食事記録に追加できます。
- **レシートスキャン:** レシートを撮影するだけで、品目と価格を自動で家計簿に登録。
- **料理写真分析:** 手料理の写真を撮ると、AIがカロリーと栄養素を自動推定します。

### 2. 🤖 AIアドバイザー
- **健康チェック:** 買い物リストや食事内容から、「糖質の摂りすぎ」「野菜不足」などをAIが分析。
- **代替案の提案:** 「ポテトチップス」の代わりに「ナッツ」を提案するなど、無理のない改善案を提示します。
- **レシピ生成:** 冷蔵庫の余り物（在庫）を選択するだけで、AIが最適なレシピを考案します。

### 3. ⚔️ ゲーミフィケーション
- **レイドバトル:** 全ユーザーで協力して「ジャンクフードゴーレム」と戦おう！あなたの「運動」と「健康的な食事」がダメージになります。
- **ミッション＆バッジ:** 日々の記録で経験値を獲得。レベルアップして新しいフレームや称号をゲット。
- **SNS機能:** 頑張りをタイムラインで共有。いいねやコメントで励まし合えます。

### 4. 🏠 家計＆生活サポート
- **在庫管理:** 賞味期限切れをアラートでお知らせ。買い忘れ・買いすぎを防ぎます。
- **買い物リスト:** AIがあなたの健康状態に合わせて、買うべき食材を提案。
- **家計簿:** 食費だけでなく、日々の収支をグラフで可視化。

---

## 📲 始め方

1. **アプリにアクセス**
   [https://oshi-para.web.app/](https://oshi-para.web.app/) をブラウザで開きます。

2. **インストール（推奨）**
   - **iPhone (Safari):** 「共有」ボタン → 「ホーム画面に追加」
   - **Android (Chrome):** メニュー「︙」 → 「アプリをインストール」

3. **アカウント作成**
   Googleアカウントまたはメールアドレスで登録。すぐに利用開始できます。

---

## 🛠️ 開発者向け情報 (For Developers)

このプロジェクトはReact + TypeScript + Firebaseで構築されたPWAです。
詳細な仕様や開発ログについては、リポジトリ内の `AGENT.md` を参照してください。

### セットアップ/引き継ぎ

- 別PCセットアップ手順: `docs/HANDOVER.md`
- 環境チェック: `npm run doctor`

### 技術スタック
- **Frontend:** React 19, TypeScript, Vite, Zustand
- **Backend:** Firebase (Auth, Firestore, Functions, Storage)
- **AI:** Google Gemini API (Flash Lite)

---

## 📂 プロジェクト構成

詳細なディレクトリ構造やファイルの説明は `AGENT.md` を参照してください。

```
life-pwa-react/
├── src/            # ソースコード
├── functions/      # Cloud Functions
├── public/         # 静的アセット
└── AGENT.md        # 開発者用ドキュメント（詳細仕様・開発ログ）
```

---

---

## 🎨 主要機能

### 1. シームレスな機能連携

#### バーコードスキャン → 在庫管理
- スキャン後、自動で在庫画面に遷移

#### 買い物リスト → 在庫管理（目玉機能）
- グラデーションカードで強調表示
- 「買い物完了後はこちら！」のキャッチコピー
- チェック済みアイテム数をリアルタイム表示
- 成功メッセージをスライドイン（3秒後に消える）

#### 在庫管理 → 買い物リスト
- 各アイテムに🛒ボタンを表示
- ワンタップで買い物リストに追加

### 2. AI健康アドバイザー

#### ハイブリッドアプローチ
- **クライアント側チェック** - 即座に警告（APIコスト0）
- **Gemini API分析** - 詳細なパーソナライズ提案（オプション）

#### 検出カテゴリ（12種類）
1. スナック菓子（ポテトチップス等）
2. 清涼飲料水（コーラ、サイダー等）
3. インスタント食品（カップラーメン等）
4. チョコレート菓子
5. 揚げ物（唐揚げ、フライドチキン等）
6. ファストフード
7. アイスクリーム
8. 洋菓子
9. 加工肉（ベーコン、ソーセージ等）
10. エナジードリンク
11. 缶詰（シロップ漬け）
12. 高脂質調味料

### 3. X風のSNS機能

- **シンプルなタイムライン** - ホバー時に背景色が変わる
- **円形のアクションボタン** - いいね、コメント、リポスト、ブックマーク、共有
- **スレッド風の投稿詳細** - リプライへのリプライ、いいね機能
- **引用リポスト** - 元の投稿を埋め込んで表示
- **メンション機能** - @usernameでメンション
- **レシピ添付** - AIレシピを投稿に添付
- **ピン留め機能** - プロフィール画面でピン留め投稿を表示
- **通知機能** - いいね・コメント・フォロー・引用・リプライ通知

---

## 🔧 開発ガイド

### 🌐 多言語対応（i18n）方針

**⚠️ 重要な開発方針：新機能の開発時は、日本語のみで実装してください。多言語対応は最終仕上げの段階で一括して行います。**

#### 理由
- 開発効率の向上：新機能追加時に毎回8言語すべてに翻訳を追加するのは非効率的
- 機能の安定化を優先：まず機能を完成させ、その後で多言語対応を行う
- 一貫性の確保：最終仕上げで一括翻訳することで、翻訳の一貫性が保たれる

#### 対応言語
- 日本語（ja）
- 英語（en）
- 中国語簡体字（zh-CN）
- 中国語繁体字（zh-TW）
- 韓国語（ko）
- ベトナム語（vi）
- ロシア語（ru）
- インドネシア語（id）

#### 実装方法
- **ライブラリ:** `i18next` + `react-i18next`
- **設定ファイル:** `src/i18n/config.ts`
- **翻訳ファイル:** `src/i18n/locales/*.json`
- **使用方法:** `const { t } = useTranslation();` → `t('key.path')`

#### 多言語対応のタイミング
1. **開発中:** 日本語のみで実装（ハードコードされた日本語文字列でOK）
2. **最終仕上げ:** すべての日本語文字列を`t()`関数に置き換え、8言語すべてに翻訳キーを追加

#### 既存の多言語対応済み機能
- 設定画面（言語選択含む）
- ダッシュボード
- 食事記録
- 運動記録
- 目標管理
- 家計簿
- 在庫管理
- 買い物リスト
- 認証画面（ログイン・登録・パスワードリセット）
- 共通コンポーネント（DatePickerModal、MonthPickerModal、Calendar等）

---

### コーディング規約

#### CSS変数を使用
```tsx
// ❌ ダメな例
style={{ background: 'white', color: '#333' }}

// ✅ 良い例
style={{ background: 'var(--card)', color: 'var(--text)' }}
```

#### Optional Chainingを使用
```tsx
// ❌ ダメな例
recipe.ingredients.slice(0, 3)

// ✅ 良い例
recipe.ingredients && recipe.ingredients.slice(0, 3)
```

### デバッグ

#### Service Workerのクリア
```javascript
// DevTools Console
await caches.keys().then(keys => Promise.all(keys.map(key => caches.delete(key))));
navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(reg => reg.unregister()));
location.reload();
```

#### localStorageのクリア
```javascript
localStorage.clear();
location.reload();
```

---

## 📝 ライセンス

このプロジェクトは個人学習用です。

---

## 🤝 コントリビューション

このプロジェクトは[Cursor](https://cursor.sh/)で開発されています。

詳細な開発履歴は[cursor.md](./cursor.md)を参照してください。

---

## 📚 参考資料

- [Vite Documentation](https://vitejs.dev/)
- [React Documentation](https://react.dev/)
- [Zustand Documentation](https://zustand.docs.pmnd.rs/)
- [Recharts Documentation](https://recharts.org/)
- [Google Gemini API](https://ai.google.dev/)
- [Firebase Documentation](https://firebase.google.com/docs)

---

## 🎯 最近の更新（2025-01-XX）

- ✅ **目標管理機能** - カロリー・予算・体重・運動の4種類の目標設定と進捗追跡、達成通知、バッジ獲得
- ✅ **運動記録機能** - 運動名・時間・消費カロリーの記録、運動目標への自動反映、日次集計
- ✅ **ダッシュボードUI改善** - コンパクトな2カラムレイアウト、目標進捗サマリー表示
- ✅ **健康情報設定機能** - 身長・体重・年齢の設定、BMI自動計算
- ✅ **週次体重入力リマインダー** - 毎週月曜日に体重入力モーダルを表示
- ✅ **健康目標に基づく買い物リスト提案** - BMI・年齢に基づく食材提案機能
- ✅ **栄養不足分析** - 過去1週間の食事記録から不足栄養素を分析し、補完食材を提案
- ✅ **AIカロリー計測** - 料理写真からカロリーを自動推定（根拠付き）
- ✅ **プロフィール編集機能** - プロフィール画面から直接編集可能
- ✅ **DM機能改善** - DM通知、未読バッジ、会話リストの未読数表示
- ✅ **ユーザーAPIキー設定** - 設定画面で各自のGemini APIキーを設定可能
- ✅ **自動リトライ機能** - 429エラー時に自動的に再試行（約37秒後）
- ✅ **無料プラン対応** - `gemini-2.5-flash-lite`モデルを使用して無料プランでも利用可能
- ✅ **BigQuery統合** - Gemini APIのログ記録とFew-shot Promptingによる精度向上
- ✅ **バーコード機能の多言語化** - スキャン画面、結果画面の日本語化完了

## 🎯 今後の予定

- [ ] Phase 7: ランキング機能（人気投稿ランキング、人気レシピランキング、トレンドハッシュタグ）
- [ ] パフォーマンス最適化（バンドルサイズ削減）
- [ ] ページ遷移アニメーション
- [ ] E2Eテスト追加（Playwright）
- [ ] アクセシビリティ向上（ARIA属性、キーボードナビゲーション）

---

**Happy Coding! 🚀**

Made with ❤️ by Cursor
