import{r as s,j as t}from"./ui-vendor-JVI_EMCz.js";import{u as A,M as S,a as W,b as L,c as U,d as _,g as $,e as w,f as F,h as H}from"./index-BvEluyUh.js";const l=280,h=4,X=({onClose:b,onPostCreated:z,quotedPostId:p,recipeData:g})=>{const{user:i}=A(),[o,C]=s.useState(""),[d,v]=s.useState([]),[x,y]=s.useState([]),[j,R]=s.useState("public"),[c,f]=s.useState(!1),[k,a]=s.useState(""),[u,M]=s.useState(null);s.useEffect(()=>{(async()=>{if(p){const r=await $(p);M(r)}})()},[p]);const B=e=>{const r=Array.from(e.target.files||[]);if(r.length===0)return;if(d.length+r.length>h){a(`ç”»åƒã¯æœ€å¤§${h}æšã¾ã§æ·»ä»˜ã§ãã¾ã™`);return}const n=[];r.forEach(T=>{const m=new FileReader;m.onloadend=()=>{n.push(m.result),n.length===r.length&&y([...x,...n])},m.readAsDataURL(T)}),v([...d,...r]),a("")},P=e=>{v(d.filter((r,n)=>n!==e)),y(x.filter((r,n)=>n!==e))},E=async()=>{if(!i){a("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„");return}if(!o.trim()){a("æŠ•ç¨¿å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return}if(o.length>l){a(`æŠ•ç¨¿ã¯${l}æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„`);return}f(!0),a("");try{console.log("ğŸ“ Checking user profile before posting...");let e=await w(i.uid);if(!e){console.log("âš ï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚è‡ªå‹•ä½œæˆã—ã¾ã™...");try{await F(i.uid,i.email||"",i.displayName||`User${i.uid.slice(0,8)}`),console.log("âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ"),e=await w(i.uid)}catch(n){console.error("âŒ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:",n),a("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚è¨­å®šç”»é¢ã‹ã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"),f(!1);return}}const r={content:o.trim(),images:d,visibility:j,quotedPostId:p,recipeData:g};await H(i.uid,r),alert("æŠ•ç¨¿ã—ã¾ã—ãŸï¼"),z(),b()}catch(e){console.error("æŠ•ç¨¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:",e),a("æŠ•ç¨¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")}finally{f(!1)}},I=[{value:"public",label:"å…¨ä½“å…¬é–‹",icon:L,description:"èª°ã§ã‚‚è¦‹ã‚‰ã‚Œã¾ã™"},{value:"followers",label:"ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼",icon:U,description:"ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã®ã¿"},{value:"private",label:"éå…¬é–‹",icon:_,description:"è‡ªåˆ†ã®ã¿"}];return t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"16px"},onClick:b,children:t.jsxs("div",{style:{background:"var(--card)",borderRadius:"16px",width:"100%",maxWidth:"600px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2)"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid var(--border)"},children:[t.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:"var(--text)",margin:0},children:"æŠ•ç¨¿ã‚’ä½œæˆ"}),t.jsx("button",{onClick:b,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-secondary)",transition:"background 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--border)"},onMouseLeave:e=>{e.currentTarget.style.background="none"},children:t.jsx(S,{size:24})})]}),t.jsxs("div",{style:{padding:"20px"},children:[t.jsx("textarea",{value:o,onChange:e=>C(e.target.value),placeholder:"ä»Šä½•ã—ã¦ã‚‹ï¼Ÿ",style:{width:"100%",minHeight:"120px",padding:"12px",border:"2px solid var(--border)",borderRadius:"12px",fontSize:"16px",color:"var(--text)",background:"var(--background)",resize:"vertical",fontFamily:"inherit",marginBottom:"12px"}}),u&&t.jsxs("div",{style:{padding:"12px",background:"var(--background)",border:"1px solid var(--border)",borderRadius:"12px",marginBottom:"12px"},children:[t.jsx("div",{style:{fontSize:"14px",color:"var(--text-secondary)",marginBottom:"8px"},children:"å¼•ç”¨å…ƒ:"}),t.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:"var(--text)"},children:u.authorName}),t.jsxs("div",{style:{fontSize:"14px",color:"var(--text)",marginTop:"4px"},children:[u.content.substring(0,100),u.content.length>100?"...":""]})]}),g&&t.jsxs("div",{style:{padding:"12px",background:"linear-gradient(135deg, rgba(22, 163, 74, 0.05), rgba(129, 199, 132, 0.05))",border:"2px solid var(--primary)",borderRadius:"12px",marginBottom:"12px"},children:[t.jsx("div",{style:{fontSize:"14px",color:"var(--text-secondary)",marginBottom:"8px"},children:"æ·»ä»˜ãƒ¬ã‚·ãƒ”:"}),t.jsxs("div",{style:{fontWeight:700,fontSize:"16px",color:"var(--text)"},children:["ğŸ‘¨â€ğŸ³ ",g.title]}),t.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginTop:"4px"},children:g.description})]}),t.jsxs("div",{style:{textAlign:"right",fontSize:"14px",color:o.length>l?"#f44336":"var(--text-secondary)",marginBottom:"16px"},children:[o.length," / ",l]}),x.length>0&&t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"12px",marginBottom:"16px"},children:x.map((e,r)=>t.jsxs("div",{style:{position:"relative",paddingBottom:"100%",borderRadius:"12px",overflow:"hidden",background:"var(--border)"},children:[t.jsx("img",{src:e,alt:`ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ${r+1}`,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}}),t.jsx("button",{onClick:()=>P(r),style:{position:"absolute",top:"4px",right:"4px",background:"rgba(0, 0, 0, 0.6)",border:"none",borderRadius:"50%",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"white"},children:t.jsx(S,{size:18})})]},r))}),d.length<h&&t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"10px 16px",background:"var(--background)",border:"2px solid var(--border)",borderRadius:"12px",cursor:"pointer",color:"var(--primary)",fontSize:"14px",fontWeight:500,marginBottom:"16px",transition:"background 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--border)"},onMouseLeave:e=>{e.currentTarget.style.background="var(--background)"},children:[t.jsx(W,{size:20}),"ç”»åƒã‚’è¿½åŠ  (",d.length,"/",h,")",t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:B,style:{display:"none"}})]}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("label",{style:{display:"block",fontSize:"14px",color:"var(--text-secondary)",marginBottom:"8px",fontWeight:500},children:"å…¬é–‹ç¯„å›²"}),t.jsx("select",{value:j,onChange:e=>R(e.target.value),style:{width:"100%",padding:"12px",border:"2px solid var(--border)",borderRadius:"12px",fontSize:"15px",color:"var(--text)",background:"var(--background)",cursor:"pointer"},children:I.map(e=>t.jsxs("option",{value:e.value,children:[e.label," - ",e.description]},e.value))})]}),k&&t.jsx("div",{style:{padding:"12px",background:"#ffebee",color:"#c62828",borderRadius:"8px",fontSize:"14px",marginBottom:"16px"},children:k}),t.jsx("button",{onClick:E,disabled:c||!o.trim()||o.length>l,style:{width:"100%",padding:"14px",background:c||!o.trim()||o.length>l?"var(--border)":"linear-gradient(135deg, var(--primary), #81c784)",color:"white",border:"none",borderRadius:"12px",fontSize:"16px",fontWeight:600,cursor:c||!o.trim()||o.length>l?"not-allowed":"pointer",transition:"transform 0.2s"},onMouseEnter:e=>{!c&&o.trim()&&o.length<=l&&(e.currentTarget.style.transform="translateY(-2px)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)"},children:c?"æŠ•ç¨¿ä¸­...":"æŠ•ç¨¿ã™ã‚‹"})]})]})})};export{X as P};
