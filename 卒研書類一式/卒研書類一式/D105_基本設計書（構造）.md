# D105 基本設計書（構造）

## 1. データベース設計 (Firestore)

### 1.1 コレクション構成

#### `users` (ユーザー情報)
- `uid` (string): ユーザーID
- `email` (string): メールアドレス
- `displayName` (string): 表示名
- `photoURL` (string): アイコンURL
- `points` (number): 保有ポイント
- `createdAt` (timestamp): 作成日時

#### `users/{uid}/settings` (ユーザー設定)
- `theme` (string): テーマ設定
- `language` (string): 言語設定
- `notifications` (boolean): 通知設定

#### `users/{uid}/health` (健康データ)
- `date` (string): 日付 (YYYY-MM-DD)
- `weight` (number): 体重
- `height` (number): 身長
- `bmi` (number): BMI

#### `users/{uid}/meals` (食事記録)
- `date` (timestamp): 記録日時
- `type` (string): 朝食/昼食/夕食/間食
- `calories` (number): カロリー
- `imageUrl` (string): 写真URL
- `memo` (string): メモ

#### `users/{uid}/expenses` (支出記録)
- `date` (timestamp): 記録日時
- `amount` (number): 金額
- `category` (string): カテゴリ
- `memo` (string): メモ

#### `users/{uid}/stocks` (在庫管理)
- `name` (string): 商品名
- `quantity` (number): 数量
- `expiryDate` (timestamp): 賞味期限
- `category` (string): カテゴリ

#### `posts` (ソーシャル投稿)
- `id` (string): 投稿ID
- `userId` (string): 投稿者ID
- `content` (string): 本文
- `imageUrl` (string): 画像URL
- `likes` (array): いいねしたユーザーIDの配列
- `createdAt` (timestamp): 投稿日時

## 2. データフロー
### 2.1 レシート登録フロー
1. クライアントで画像を撮影・アップロード
2. Cloud Functions (`analyzeReceipt`) をトリガー
3. CLOVA OCR APIでテキスト抽出
4. Gemini APIで構造化データ（店舗名、品目、金額）に変換
5. クライアントに結果を返却
6. ユーザーが確認・修正してFirestoreに保存

### 2.2 AIレシピ提案フロー
1. クライアントで食材・条件を入力
2. Cloud Functions (`generateRecipe`) をトリガー
3. Gemini APIでレシピ生成
4. クライアントにレシピを表示
